# Springboot-JPA-Blog
* ê¸°ëŠ¥
	* íšŒì›ê°€ì…
	* ë¡œê·¸ì¸
	* ê¸€ ì“°ê¸°/ìˆ˜ì •/ì‚­ì œ/ìƒì„¸ë³´ê¸°
	* ê¸€ ëª©ë¡ ë³´ê¸°
	* ì¸ì¦(ìŠ¤í”„ë§ ì‹œíë¦¬í‹°)
	* íšŒì›ì •ë³´ ìˆ˜ì •
	* í˜ì´ì§•
	* ëŒ“ê¸€ ë‹¬ê¸°
	* ëŒ“ê¸€ ì‚­ì œ
	* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
	
* ì‚¬ìš© ê¸°ìˆ 
	* ë°±ì—”ë“œ 
		* SpringBoot-JPA (ì—°ê´€ê´€ê³„ ë§¤í•‘ê³¼ í…Œì´ë¸” ìƒì„±)
		* MySQL - Spring ì—°ê²°
		* Ajax-Json ë°ì´í„° í†µì‹ 
		* Spring Security ì‚¬ìš© ë¡œê·¸ì¸ í˜ì´ì§€ ì»¤ìŠ¤í„°ë§ˆì´ì§•, ë¹„ë°€ë²ˆí˜¸ í•´ì‰¬ í›„ íšŒì›ê°€ì…
	* í”„ë¡ íŠ¸ì—”ë“œ
		* Html/css
		* Bootstrap
	* í™”ë©´ êµ¬ì„±
		* jsp
	* OAuth2.0  

* ERD

![image](https://user-images.githubusercontent.com/86938974/170266340-4a5b549a-a424-43bc-b274-e7f3b818a92b.png)

	

* í™˜ê²½ì„¸íŒ…
	- Oracle JDK 1.8
	- MySQL 5.7
MySQL Workbench ì‹¤í–‰ -> ì ‘ì†
![image](https://user-images.githubusercontent.com/86938974/166133310-bb4c5e46-d804-4bdf-ad6f-b5fcd7b68422.png)
	- Spring Tools 4.11.0
![image](https://user-images.githubusercontent.com/86938974/166133396-ae6e96a3-b753-4629-a752-cb05f30d6687.png)
![image](https://user-images.githubusercontent.com/86938974/166133425-71cdc6d3-3ce6-4135-86b8-75c84ce39aef.png)

Intellij ê²€ìƒ‰ -> ë‹¤ìš´ë¡œë“œ
![image](https://user-images.githubusercontent.com/86938974/166133455-80382c06-575b-4d58-bef2-fad863346876.png)
-UTF-8 ì„¸íŒ…
![image](https://user-images.githubusercontent.com/86938974/166133509-d2c50cb2-7557-4e2d-990b-10cbcbed45be.png)
![image](https://user-images.githubusercontent.com/86938974/166133519-2cd81efd-2743-4c29-a861-b9074e178d14.png)
![image](https://user-images.githubusercontent.com/86938974/166133525-fb47422e-dd57-4e91-ad91-f471c784432b.png)
![image](https://user-images.githubusercontent.com/86938974/166133531-81fd6a39-ce19-4d85-888a-0db11e9072d2.png)
![image](https://user-images.githubusercontent.com/86938974/166133534-d393c39c-fc2f-4f36-80f6-f46dc4ce36c7.png)

-STS4 ì›¹ ê°œë°œ í™˜ê²½ ì„¸íŒ…
STS4 javaEE í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜(JSP ì›¹ ê°œë°œ í™˜ê²½)
![image](https://user-images.githubusercontent.com/86938974/166133589-d5b10223-64cb-4d96-b24c-7597d14077d1.png)
![image](https://user-images.githubusercontent.com/86938974/166133615-284b8520-5e8d-4150-87a2-7996c175db4d.png)
STS4 Javascript íŒŒì¼ ì¸ì‹ ì„¤ì •
*.js Add
![image](https://user-images.githubusercontent.com/86938974/166133656-9a375c7a-c054-43b9-9a19-14c9bf67b118.png)
default ì„¤ì •
![image](https://user-images.githubusercontent.com/86938974/166133670-1e9e31d6-8f3e-4e87-88e1-94aff24b8d91.png)
![image](https://user-images.githubusercontent.com/86938974/166133699-130c176c-1ea7-44ad-ab2e-d3ba8a3235e8.png)
CSS,HTML,JSP Files Encodingë„ UTF-8ë¡œ ë³€ê²½

![image](https://user-images.githubusercontent.com/86938974/166133714-04fd2673-c301-48f5-bdf7-879908c92ef1.png)

-STS4 Lombok í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

Projectlombok.org/download
ë‹¤ìš´ë¡œë“œ í´ë” -> git bash here -> java -jar lombok.jar

* ì˜ì¡´ì„± ì„¤ì •

![image](https://user-images.githubusercontent.com/86938974/166133777-6e7d5653-ab2b-4301-bc11-b48198161cf4.png)

ì²´í¬ëª©ë¡

- Developer Tools
  - Spring Boot DevTools (íŒŒì¼ì´ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì²´ì¸ì§€ ë  ë•Œ, ë³€ê²½ì´ ì¼ì–´ë‚¬ìœ¼ë‹ˆ ìë™ ì¬ì‹œì‘)
  - Lombok(ê²Œí„°ì„¸í„°, ìƒì„±ìë¥¼ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬)
	
- SQL
  - Spring Data JPA(ë°ì´í„°ë² ì´ìŠ¤ë¥¼ JPAë¥¼ í†µí•´ ë§Œë“¦ = ORM)
  MySQL Driver
	
- Security
  - Spring Security(ë³´ì•ˆ ê¸°ëŠ¥ì— ëŒ€í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬)
	
- Web
  - Spring Web(ì–´ë…¸í…Œì´ì…˜ì„ ì“°ê¸° ìœ„í•´ì„œ ì²´í¬í•¨, ë‚´ì¥í˜• ì»¨í…Œì´ë„ˆë¡œ í†°ìº£ì„ ê¸°ë³¸ íƒ‘ì¬)
	
![image](https://user-images.githubusercontent.com/86938974/166133959-26fed241-57bc-48fd-8141-c58e20255551.png)

pom.xmlì— ì¶”ê°€í•´ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/86938974/166134087-ceafe5ef-8e3f-4633-94c5-1ffe382c89c2.png)

![image](https://user-images.githubusercontent.com/86938974/167418257-479daa1e-c39c-47bf-a6fe-6e524c96406c.png)

* ìŠ¤í”„ë§ì˜ ì œì–´ì˜ ì—­ì „ (IoC)
	* ì‹±ê¸€í†¤ íŒ¨í„´
	* ë ˆí¼ëŸ°ìŠ¤ ë³€ìˆ˜ë¥¼ ìŠ¤í”„ë§ì´ ê´€ë¦¬
	* ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” : íŒ¨í‚¤ì§€ ì´í•˜ë¥¼ ì „ë¶€ ìŠ¤ìº” í›„ í•„ìš”í•œ ê²ƒë“¤ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œ
	* ì´ í”„ë¡œì íŠ¸ì—ì„  com.cos.blogë¼ê³  íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ ê·¸ ì´í•˜ë§Œ ìŠ¤í”„ë§ì´ ìŠ¤ìº”í•œë‹¤.
	* com.cos.testì²˜ëŸ¼ ë§Œë“¤ì–´ì„œ ì‘ì—…íŒŒì¼ì„ ê·¸ ì•„ë˜ì— ë§Œë“¤ë©´ ë©”ëª¨ë¦¬ì— ëœ¨ì§€ ì•ŠëŠ”ë‹¤.
	* ë§Œë“  íŒ¨í‚¤ì§€ ì´í•˜ë¡œ ë§Œë“œëŠ”ê²ƒì´ ì¤‘ìš”(ì•„ë˜ì™€ ê°™ì´)

![image](https://user-images.githubusercontent.com/86938974/167418272-6a3b56d3-91b0-489c-8b0f-fddc8edcf35d.png)

```
@Controller : ìŠ¤í”„ë§ì´ com.cos.blog íŒ¨í‚¤ì§€ ì´í•˜ë¥¼ ìŠ¤ìº”í•´ì„œ ëª¨ë“  íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— newí•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê³  íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆëŠ” í´ë˜ìŠ¤ íŒŒì¼ë“¤ì„ newí•´ì„œ(IoC) ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê´€ë¦¬í•´ì¤€ë‹¤.
@GetMapping : ì£¼ì†Œ ë§¤í•‘(ë¸Œë¼ìš°ì €ì—ì„œ ì°í˜)
	=> http://localhost:8080/test/hello

```
* ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ì£¼ê¸°
```
root ì‚¬ìš©ìë¡œ MySQL ì ‘ì†
create user 'cos'@'%' identified by 'cos1234';

GRANT ALL PRIVILEGES ON *.* To 'cos'@'%';
create database blog;
use blog;
```
* MySQL í•œê¸€ ì„¤ì •
	* Cë“œë¼ì´ë¸Œ ì•ˆì— ì•„ë˜ ê²½ë¡œ ì´ë™
![image](https://user-images.githubusercontent.com/86938974/167419848-818f5fe5-4ed4-419a-8b0b-5d727e4be3d7.png)
	* ì•„ë˜ì™€ ê°™ì´ ì…ë ¥
![image](https://user-images.githubusercontent.com/86938974/167420007-4c9dfc21-84ed-42f2-b9eb-8384cbc0377c.png)
![image](https://user-images.githubusercontent.com/86938974/167420093-7812c3f5-2fff-4fba-a91b-ee323f9823e3.png)
![image](https://user-images.githubusercontent.com/86938974/167420173-a083976b-9a9a-44d1-8e8b-fb295498919a.png)

* í•œê¸€ ì„¤ì • í™•ì¸
```
show variables like 'c%';
```
![image](https://user-images.githubusercontent.com/86938974/167420442-d4614b21-a6ff-4008-a99e-7f881baedae3.png)

	* pom.xml íŒŒì¼ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•œë‹¤.
![image](https://user-images.githubusercontent.com/86938974/167420756-fbab4fcf-9fe9-4707-8af9-3e44cfa30a9d.png)
![image](https://user-images.githubusercontent.com/86938974/167420900-84e3a240-9b9b-4731-9d95-5f70f9473082.png)

* MySQL í”„ë¡œì íŠ¸ ì—°ê²°
	* application.ymlë¡œ ìˆ˜ì • 
![image](https://user-images.githubusercontent.com/86938974/167421490-7090bb9a-e208-4628-8cc9-66255c5106b5.png)
* yml íŠ¹ì§•
	* ymlì€ json í˜•ì‹ê³¼ ë¹„ìŠ·í•œ ë°ì´í„° íƒ€ì…ì„ ê°€ì§„ë‹¤.
	* ymlì€ ëª¨ë“  ìŠ¤í”„ë§ì— ëŒ€í•œ ì„¤ì •ì„ í•  ìˆ˜ ìˆë‹¤.
	* ë“¤ì—¬ì“°ê¸°ë¡œ êµ¬ë¶„í•œë‹¤.
- ì½”ë“œ ì‚½ì…
```
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/blog?serverTimezone=Asia/Seoul
    username: cos
    password: cos1234
```

* HTTP 1.1 ìš”ì²­ë°©ì‹
	* í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì—ê²Œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ìš”ì²­, ì„œë²„ê°€ ì‘ë‹µí•´ì£¼ëŠ” êµ¬ì¡°ê°€ HTTPêµ¬ì¡°
	* HTTP í†µì‹ ì€ ì•½ì†ëœ í†µì‹ ì´ í•„ìš”í•˜ë‹¤.(ë°ì´í„°ë¥¼ ê°–ê³  ìˆëŠ” ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì™€ì˜ í†µì‹ )
	* í†µì‹ ë°©ë²•(ìš”ì²­ì˜ ë°©ë²•) : Get, Post, Put, Delete 
		* Get : ë°ì´í„°ë¥¼ ìš”ì²­ - Select
		* Post : ë°ì´í„°ë¥¼ ì¶”ê°€ - Insert
		* Put : ë°ì´í„°ë¥¼ ìˆ˜ì • - Update
		* Delete : ë°ì´í„°ë¥¼ ì‚­ì œ - Delete
		* ì–´ë–¤ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ”ì§€ --> MIME íƒ€ì…
	* PostMan ì‚¬ìš©
	* HTTP í†µì‹ ì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ í†µì‹ í•  ë•Œ ìš”ì²­ì‹œë§ˆë‹¤ ìŠ¤íŠ¸ë¦¼(ì„ )ì„ ëŠê³  ë‹¤ì‹œ ì—°ê²°í•´ì„œ Dataë¥¼ ì£¼ê³  ë°›ëŠ”ë‹¤ : Stateless (ì—°ê²°ì´ ì§€ì†ë˜ì§€ ì•ŠìŒ) í•„ìš”í•  ë•Œë§ˆë‹¤ ì—°ê²°í•˜ë¯€ë¡œ ì„œë²„ì…ì¥ì—ì„œ ë¶€í•˜ê°€ ì ë‹¤.
	* ì±„íŒ…ì²˜ëŸ¼ ì§€ì†ì ì¸ ì‘ë‹µê³¼ ìš”ì²­ì´ í•„ìš”í•œê²½ìš° Statefulë°©ì‹ì„ ì“´ë‹¤ : ì—°ê²°ì´ ì§€ì†ë˜ëŠ” ë°©ì‹
	* HTTP ë°©ì‹ì€ ëŠê³  ë‹¤ì‹œ ì—°ê²°í•˜ë¯€ë¡œ ë‹¤ì‹œ ì¸ì¦ì„ í•´ì•¼í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì‹œíë¦¬í‹°ë¥¼ ì‚¬ìš©í•´ì„œ ì„¸ì…˜ì„ ìœ ì§€í•¨

* MIME íƒ€ì…
	* í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡ëœ ë¬¸ì„œì˜ ë‹¤ì–‘ì„±ì„ ì•Œë ¤ì¤Œ
	* type/subtype êµ¬ì¡°
	* text/html , img/jpeg (ë³´ë‚´ëŠ” ë°ì´í„°ëŠ” ì´ë¯¸ì§€ì´ë©°, ê·¸ ì´ë¯¸ì§€ë“¤ ì¤‘ì—ì„œë„ jpegë‹¤.)
	* audio/mpeg, text/plain ë“±ë“± ì¢…ë¥˜ê°€ ë§ìŒ

```
@Controller : ì‚¬ìš©ìê°€ ìš”ì²­ -> ì‘ë‹µ(HTML íŒŒì¼)
@RestController : ì‚¬ìš©ìê°€ ìš”ì²­ -> ì‘ë‹µ(Data) 
```

	* ì¸í„°ë„· ë¸Œë¼ìš°ì € ìš”ì²­ì€ ë¬´ì¡°ê±´ Get ìš”ì²­ë°–ì— í•  ìˆ˜ ì—†ë‹¤.
* Get ìš”ì²­ ë°›ì•„ë³´ê¸°

![image](https://user-images.githubusercontent.com/86938974/167427080-0f05502e-a310-4a06-b9aa-a5f41ce03fe2.png)
![image](https://user-images.githubusercontent.com/86938974/167427155-671a9645-82f4-4b1e-875b-7bf9f395b602.png)
![image](https://user-images.githubusercontent.com/86938974/167427210-f8cc1be5-71ed-4f64-8bb9-5d7e4b80e0a9.png)
* ì•„ë˜ì™€ ê°™ì´ ë°›ì•„ë„ ë¨
	* Springì€ ? ë’¤ì˜ ê°’ë“¤ì„ ìë™ìœ¼ë¡œ memberì— ë„£ì–´ì¤€ë‹¤. 
	* Member.javaë¥¼ ë§Œë“¤ì–´ì„œ getterì™€ setterë¥¼ ë§Œë“¤ì–´ ì¤Œ 	
![image](https://user-images.githubusercontent.com/86938974/167427370-1b42fbf2-643d-4707-a7dd-19573fc07225.png
![image](https://user-images.githubusercontent.com/86938974/167427301-5e9df579-ada9-4472-a81f-ee4d9a2b9655.png)

* Post ìš”ì²­ ë°›ì•„ë³´ê¸°
	* ?ë¡œ ë°›ì§€ ì•Šê³  bodyë¡œ ë°›ìŒ
![image](https://user-images.githubusercontent.com/86938974/167427610-039ae80f-e069-4dd1-aa32-1c299a931903.png)
![image](https://user-images.githubusercontent.com/86938974/167427724-63d60454-f9ec-40cc-b70d-a9596f376d6e.png)
	* RequestBody ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë°›ì„ ìˆ˜ ìˆë‹¤.
![image](https://user-images.githubusercontent.com/86938974/167427897-8d649f01-7ffa-4353-b5bc-50e1291facf3.png)
![image](https://user-images.githubusercontent.com/86938974/167428040-1d9b3d59-4bca-4068-abc5-06762b21e2d7.png)
	* application/JSON ë°ì´í„° ë³´ë‚´ë³´ê¸°
![image](https://user-images.githubusercontent.com/86938974/167428272-a345c53f-0bd7-4868-9646-26df27896e5e.png)
	* ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿”ì£¼ë©´
![image](https://user-images.githubusercontent.com/86938974/167428380-a31d1e29-c58c-482d-b596-e10185c4ea68.png)
![image](https://user-images.githubusercontent.com/86938974/167428425-c4c88614-eea2-44da-98ad-febbc9fa32a0.png)
	* ì¦‰ sendì‹œ ìë™ìœ¼ë¡œ íŒŒì‹±í•´ì„œ ì˜¤ë¸Œì íŠ¸ì— ë„£ì–´ì¤€ë‹¤. (Member mì—) ì´ë¥¼ ìŠ¤í”„ë§ë¶€íŠ¸ì˜ MessageConverterê°€ í•´ì¤€ë‹¤.
	
* Maven
	* ì–´ë–¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë©´ í•´ë‹¹ ì‚¬ì´íŠ¸ë¡œ ê°€ì„œ ë‹¤ìš´ë°›ëŠ”ë‹¤.
	* ë‹¤ìš´íŒŒì¼ì„ copyí•˜ì—¬ ë‚´ í”„ë¡œì íŠ¸ ë‚´ë¶€(lib)ì— ë„£ê³  ë¹Œë“œí•œë‹¤.
	* ë˜ëŠ” copyí•˜ì§€ ì•Šê³  c:\libë¥¼ ë§Œë“¤ì–´ ì´ ê³³ì— copyí•œë‹¤ë©´ í•˜ë‚˜ì˜ í´ë”ë¥¼ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë“¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
	* ex) ì¤‘ì•™ ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ì„œ JSoup, Lobok, OJDBC, GSON ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ë„£ì–´ë‘ë©´ í•„ìš”ì‹œ ì¤‘ì•™ì €ì¥ì†Œì—ë§Œ ì ‘ê·¼í•˜ë©´ ëœë‹¤. pom.xmlì´ë¼ëŠ” íŒŒì¼ì— í•„ìš”í•œ ê¸°ìˆ ( ex) OJDBCê°€ í•„ìš”í•´)ì„ ì¨ë†“ê¸°ë§Œ í•˜ë©´ Mavenì´ë¼ëŠ” í”„ë¡œì íŠ¸ ê´€ë¦¬ ë„êµ¬ê°€ ì´ë¥¼ ì½ì–´ì„œ ì¤‘ì•™ì €ì¥ì†Œì—ì„œ ë‹¤ìš´ë°›ì•„ .m2 í´ë”ë¥¼ ë§Œë“¤ê³  repositoryë¥¼ ë§Œë“¤ì–´ ê·¸ ë‚´ë¶€ì— ë‹¤ ë‹¤ìš´ë°›ì•„ì£¼ê³  ë¹Œë“œë¥¼ í•´ì¤€ë‹¤. => ì‚¬ì´íŠ¸ë¥¼ ëŒì•„ë‹¤ë‹ˆë©´ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ìš´ ë°›ì„ í•„ìš”ê°€ ì—†ì´ pom.xmlì— ê¸°ìˆ ë§Œ í•´ì£¼ë©´ ëœë‹¤. ë¦¬ëˆ…ìŠ¤ì—ì„œë„ Mavenì„ ì„¤ì¹˜í•˜ì—¬ pom.xmlì— ê¸°ìˆ ë§Œ í•´ì£¼ë©´ ë
* Lombok ì„¸íŒ…
	* Mavenì´ ê´€ë¦¬í•˜ëŠ” í´ë” ë“¤ì–´ê°€ê¸°
![image](https://user-images.githubusercontent.com/86938974/167430116-8bcb2306-0f20-4860-bf32-0ee4dccbd1f5.png)
	* jar íŒŒì¼ ì‚¬ìš©
![image](https://user-images.githubusercontent.com/86938974/167430289-2333940c-32e0-400b-9755-9eea61fb9d5f.png)
![image](https://user-images.githubusercontent.com/86938974/167430448-0c20797d-687e-4894-bb62-7ee9d012dfa5.png)
![image](https://user-images.githubusercontent.com/86938974/167430503-29b0712d-5652-4a86-a08d-39fede79b86f.png)
![image](https://user-images.githubusercontent.com/86938974/167430609-f6456b54-7963-4274-b26f-98413391c766.png)
	* cmdì°½ìœ¼ë¡œ cd ëª…ë ¹ì–´ë¡œ í´ë” ì´ë™ í›„ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•´ë„ ëœë‹¤.
```
java -jar lombok-1.18.12.jar
```
```
@Getter : getter ë§Œë“¤ì–´ì¤Œ
@Setter : setter ë§Œë“¤ì–´ì¤Œ
@Data : getter, setter ë‹¤ ë§Œë“¤ì–´ì¤Œ
@AllArgsConstructor : ì „ì²´ ìƒì„±ì ë§Œë“¤ì–´ì¤Œ
@NoArgsConstructor : ë¹ˆ ìƒì„±ì ë§Œë“¤ì–´ì¤Œ
```
	* ìœ„ ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ getter, setterë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ì´ìš©í•  ìˆ˜ ìˆë‹¤.
![image](https://user-images.githubusercontent.com/86938974/167431767-64e88f4a-e91e-4c08-9a3e-fe8a7ee92b76.png)
![image](https://user-images.githubusercontent.com/86938974/167431895-2344975b-ff62-41c8-978e-05b654838660.png)

```
@Builder : ë‚´ê°€ ë„£ê³ ì‹¶ì€ ë°ì´í„°ë¥¼ ë„£ì„ ìˆ˜ ìˆë‹¤. ìˆœì„œë„ í•„ìš” ì—†ìŒ
@Builder
public Member(int id, String username, String password, String email) {
	this.id = id;
	this.username = username;
	this.password = password;
	this.email = email;
}
```
```
@GetMapping("/http/lombok")
	public String lombokTest() {
		Member m = Member.builder().username("ssar").password("1234").email("ssar@nate.com").build();
		System.out.println(TAG+"getter:"+m.getUsername());
		m.setUsername("cos");
		System.out.println(TAG+"setter:"+m.getUsername());
		return "lombok test ì™„ë£Œ";
	}
```
* yaml
	* ìŠ¤í”„ë§ì€ í¬íŠ¸, DB ì—°ê²°, ì¸ì½”ë”© ë“± ì „ë°˜ì ì¸ ì„¤ì •ì„ yamlíŒŒì¼ì—ì„œ í•œë‹¤..
	* keyì™€ valueì‚¬ì´ì—” í•œ ì¹¸ ë„ì–´ì ¸ì•¼ í•œë‹¤
	* ì¤‘ê´„í˜¸ê°€ ì—†ì´ ë“¤ì—¬ì“°ê¸°ê°€ ë˜ì–´ ìˆìŒ(ìŠ¤í˜ì´ìŠ¤ ë‘ ì¹¸)
	* ì´ëŸ¬í•œ ì´ìœ ë¡œ Jsonë³´ë‹¤ ê°€ë³ë‹¤
	* ìŠ¤í”„ë§ì—ì„œëŠ” ì´ ì‚¬í•­ë“¤ì„ application.ymlì— ì €ì¥

![image](https://user-images.githubusercontent.com/86938974/167644837-74c76de5-e7c4-412c-a5c7-4def3d80924b.png)
	* ìŠ¤í”„ë§ì´ ì‹¤í–‰í•˜ê¸° ì§ì „ì— ì´ íŒŒì¼ì„ ì½ëŠ”ë‹¤.
```
* í¬íŠ¸ ì•ˆì— context ì„¤ì • : ê¸°ë³¸ ì£¼ì†Œë¥¼ localhost:8000/ ìœ¼ë¡œ ì§€ì •
server:
  port: 8000
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
    
spring:
  mvc:
    view:
      prefix: /WEB-INF/views/
      suffix: .jsp
      
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/blog?serverTimezone=Asia/Seoul
    username: cos
    password: cos1234
    
  jpa:
    open-in-view: true
    hibernate:
      ddl-auto: update
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
      use-new-id-generator-mappings: false
    show-sql: true
    properties:
      hibernate.format_sql: true

  jackson:
    serialization:
      fail-on-empty-beans: false
      
cos:
  key: cos1234

```
	* physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
=> í…Œì´ë¸”ì„ ë§Œë“¤ ë•Œ ìŠ¤í”„ë§ì—ì„œì˜ ë³€ìˆ˜ëª… ê·¸ëŒ€ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.
	* jpaì˜ ddl-auto : create --> ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ ì‹¤í–‰ì‹œ í•­ìƒ í…Œì´ë¸”ì„ ìƒˆë¡œ ë§Œë“¦, ì²˜ìŒ ì´í›„ì—” updateë¡œ ë°”ê¿”ì¤˜ì•¼í•¨ 
	* ControllerëŠ” íŒŒì¼ì„ ë¦¬í„´í•  ë•Œ ì“´ë‹¤. íŒŒì¼ë¦¬í„´ì˜ ê¸°ë³¸ ê²½ë¡œëŠ” src/main//resources/staticì´ë‹¤.
	* ë¦¬í„´ëª… : /home.html ì„ í•´ì¤˜ì•¼
	* src/main//resources/static/home.htmlì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.
	
![image](https://user-images.githubusercontent.com/86938974/167646550-c159dd69-907d-4855-bebd-a89d5e97d447.png)
	* static í´ë”ëŠ” ì •ì  íŒŒì¼ë§Œ ì¸ì‹ ê°€ëŠ¥ -> ì´ë¯¸ì§€ ë“±, jspëŠ” ëª» ì°¾ëŠ”ë‹¤.
	* ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ prefixì™€ suffixë¥¼ ì§€ì •í•´ì¤€ë‹¤. 
```
spring:
  mvc:
    view:
      prefix: /WEB-INF/views/
      suffix: .jsp
```
![image](https://user-images.githubusercontent.com/86938974/167647279-6d87ceca-5cb5-4277-961b-49642abee658.png)
	* ë‹¤ìŒê³¼ ê°™ì´ ë§¤í•‘í•˜ë©´ ë¨ (prefixì™€ suffixë¥¼ ì´ìš©)	
![image](https://user-images.githubusercontent.com/86938974/167647369-98d90c11-99c2-4f10-a097-4277233d777a.png)

* JPAì´ìš© í…Œì´ë¸” ìƒì„± Blog í…Œì´ë¸” ë§Œë“¤ê¸°(User, Board, Reply)
	* model íŒ¨í‚¤ì§€ ìƒì„± 
![image](https://user-images.githubusercontent.com/86938974/167647817-421b1752-6288-42a5-82e3-eb67d612689a.png)
	* User, Board, Reply ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/167647910-0334c5a5-7ee7-481a-bc9c-8b3aba9dcf96.png)

```
package com.cos.blog.model;

import java.sql.Timestamp;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EnumType;
import javax.persistence.Enumerated;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

import org.hibernate.annotations.CreationTimestamp;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;


//ORM -> Java(ë‹¤ë¥¸ì–¸ì–´) Object -> í…Œì´ë¸”ë¡œ ë§¤í•‘í•´ì£¼ëŠ” ê¸°ìˆ 
//í…Œì´ë¸”ë¡œ ë§Œë“¤ê¸° ìœ„í•´
@Entity //User í´ë˜ìŠ¤ê°€ MySQLì— í…Œì´ë¸”ì´ ìƒì„±ì´ ëœë‹¤.
@Data // Getterì™€ Setterê°€ ë‹¤ ìˆë‹¤.
@NoArgsConstructor //ë¹ˆ ìƒì„±ì
@AllArgsConstructor //ì „ì²´ ìƒì„±ì
@Builder //ë¹Œë”íŒ¨í„´
//@DynamicInsert // insertì‹œì— nullì¸ í•„ë“œë¥¼ ì œì™¸ì‹œí‚¨ë‹¤. Defaultê°’ì— nullì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë°©ì§€, Defaultê°€ ê·¸ëŒ€ë¡œ ìƒì„± ëœë‹¤.
public class User {
	 
	@Id //Primary Key
	@GeneratedValue(strategy = GenerationType.IDENTITY) // í”„ë¡œì íŠ¸ì—ì„œ ì—°ê²°ëœ DBì˜ ë„˜ë²„ë§ ì „ëµì„ ë”°ë¼ê°„ë‹¤.
	private int id; //ì‹œí€€ìŠ¤, auto_increment, ìë™ ì…ë ¥
	
	@Column(nullable = false, length = 100, unique = true)
	private String username; //ì•„ì´ë””
	
	@Column(nullable = false, length = 100) //123456 => í•´ì‰¬(ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”)
	private String password;
	
	@Column(nullable = false, length = 50)
	private String email;
	
	//	@ColumnDefault("user")
	// DBëŠ” RoleTypeì´ë¼ëŠ”ê²Œ ì—†ë‹¤.
	@Enumerated(EnumType.STRING)
	private RoleType role; //Enumì„ ì“°ëŠ”ê²Œ ì¢‹ë‹¤. // ADMIN, USER ë„ë©”ì¸ ì„¤ì •í•˜ì—¬ ì‹¤ìˆ˜ ë°©ì§€
	
	private String oauth; //ì¹´ì¹´ì˜¤, êµ¬ê¸€ , ì–´ë””ë¡œ ë¡œê·¸ì¸ í–ˆëŠ”ì§€
	
	@CreationTimestamp //ì‹œê°„ì´ ìë™ ì…ë ¥
	private Timestamp createDate;
	
}
```
- @Entity : í…Œì´ë¸”í™” ì‹œí‚´( User í´ë˜ìŠ¤ê°€ ìŠ¤í”„ë§ë¶€íŠ¸ê°€ ì‹¤í–‰ë  ë•Œ MySQLì— í…Œì´ë¸”ì´ ìƒì„±ì´ ëœë‹¤. )
- @Id : Primary Key
- @GeneratedValue(strategy = GenerationType.IDENTITY) : í”„ë¡œì íŠ¸ì—ì„œ ì—°ê²°ëœ DBì˜ ë„˜ë²„ë§ ì „ëµì„ ë”°ë¼ê°„ë‹¤. MySQLì´ë¯€ë¡œ auto_increment ì „ëµì„ ë”°ë¼ê°.
- applicationì˜ JPA ì„¤ì •ì—ì„œ use-new-id-generator-mappings:falseë¥¼ í•´ì¤¬ìœ¼ë¯€ë¡œ JPAì˜ ì „ëµì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. 
- @Column(nullable=false, length = 30) : nullí—ˆìš©x , ê¸¸ì´ 30ì
- @CreationTimestamp : ì‹œê°„ì´ ìë™ ì…ë ¥
- @ColumnDefault : defaultê°’ ì„¤ì •
- idì™€ createDateëŠ” ìë™ ì…ë ¥ì´ë‹¤.
- idëŠ” ì‹œí€€ìŠ¤, auto_increment ì „ëµì„ ì‚¬ìš©
- username : ì•„ì´ë””
- password : ë¹„ë°€ë²ˆí˜¸
- email : ì´ë©”ì¼ ì£¼ì†Œ

	* ddl-autoë¥¼ createë¡œ, show-sqlì„ trueë¡œ ì„¤ì •í•˜ë©´ í”„ë¡œì íŠ¸ ì‹¤í–‰ë§ˆë‹¤ ë‹¤ìŒê³¼ ê°™ì´ í…Œì´ë¸”ì„ ë§Œë“ ë‹¤.
![image](https://user-images.githubusercontent.com/86938974/167650362-54b2c580-6011-4ebb-9215-b7afa0932dfc.png)

	* ë‹¤ìŒê³¼ ê°™ì´ í…Œì´ë¸”ì´ ë§Œë“¤ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
![image](https://user-images.githubusercontent.com/86938974/167651006-ac366067-fc1e-4f50-bef8-736485958743.png)
	* JPAëŠ” ORMì´ê¸° ë•Œë¬¸ì— javaì— ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ í…Œì´ë¸”ë¡œ ë§¤í•‘í•´ì¤€ë‹¤. => ì‚¬ìš©ìëŠ” ì˜¤ë¸Œì íŠ¸ë§Œ ë§Œë“¤ë©´ ë¨
	* ì¦‰ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ê³  ì €ì¥í•˜ë©´ ì¿¼ë¦¬ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ëŠ”ë°,
![image](https://user-images.githubusercontent.com/86938974/167651300-cf17f543-4936-45c3-8f2e-2be0881ddc0d.png)
	* MySQLì—ì„œ ë°”ë¡œ í™•ì¸í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ emì´ ë°”ë€ë‹¤. JPAê°€ ë‚´ê°€ ë§Œë“  ì˜¤ë¸Œì íŠ¸ë¥¼ í…Œì´ë¸”ë¡œ ë§¤í•‘í•´ì£¼ëŠ” ORM ì´ê¸°ë•Œë¬¸
![image](https://user-images.githubusercontent.com/86938974/167651369-4b543484-caeb-4b67-b038-f9f2eea3319e.png)

	* Board í…Œì´ë¸” ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168274620-503e755a-151c-4194-9096-82da2fce8cc9.png)
```
package com.cos.blog.model;

import java.sql.Timestamp;
import java.util.List;

import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.Lob;
import javax.persistence.ManyToOne;
import javax.persistence.OneToMany;
import javax.persistence.OrderBy;

import org.hibernate.annotations.CreationTimestamp;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;



@Data //getter setterê°€ ë‹¤ ìƒì„±ë¨
@NoArgsConstructor //ë¹ˆ ìƒì„±ì
@AllArgsConstructor //ì „ì²´ ìƒì„±ì
@Builder
@Entity //ë°ì´í„°ë² ì´ìŠ¤ì— ë§¤í•‘ì„ ì‹œì¼œì£¼ëŠ” ORMí´ë˜ìŠ¤ì´ë‹¤.
public class Board {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY) // auto_increment
	private int id;
	
	@Column(nullable = false, length = 100)
	private String title;
	
	@Lob //ëŒ€ìš©ëŸ‰ ë°ì´í„° ì“¸ë•Œ ì‚¬ìš©
	private String content; //ì„¬ë¨¸ë…¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ <html>íƒœê·¸ê°€ ì„ì—¬ì„œ ë””ìì¸ì´ ë¨.
	
	//	@ColumnDefault("0")
	private int count; //ì¡°íšŒìˆ˜
	
	//ì–˜ë„ ì™¸ë˜í‚¤ ì´ë¯€ë¡œ JPAì— ì˜í•´ ìë™ìœ¼ë¡œ Join
	//fetch = FetchType.EAGER = Boardí…Œì´ë¸”ì„ ì…€ë ‰íŠ¸í•˜ë©´, user	ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ê²Œ, í•œ ê±´ ë°–ì— ì—†ìœ¼ë‹ˆ (replyì™€ëŠ” ë‹¤ë¥´ê²Œ)
	//fetchíƒ€ì…ì´ EAGERì´ë©´ ë¬´ì¡°ê±´ ë“¤ê³ ì™€ì•¼ í•˜ëŠ” ì •ë³´ë‹¤. ì¦‰ ì™¸ë˜í‚¤ì´ë©´ì„œ ê²Œì‹œê¸€ì€ UserIdê°€ ê¼­ í•„ìš”í•˜ë‹¤. ì‘ì„±ì ì´ë¯€ë¡œ, ê·¸ë˜ì„œ EAGERë¡œ ê¼­ ë“¤ê³ ì™€ì¤€ë‹¤.
	@ManyToOne(fetch = FetchType.EAGER) //Boardê°€ Manyê³ , Userê°€ Oneì´ë¼ëŠ” ëœ» = í•œ ëª…ì˜ ìœ ì €ëŠ” ì—¬ëŸ¬ê°œì˜ ê²Œì‹œê¸€ì„ ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ëœ»
	@JoinColumn(name="userId") // í•„ë“œ ê°’ì€ userIdë¼ê³  ë§Œë“¤ì–´ì§
	private User user; //DBëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ë‹¤. FK, ìë°”ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ìë°”ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ í˜•íƒœì— ë§ì¶°ì•¼í•¨
	// Userê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ì°¸ì¡°í•¨
	
	//Boardë¥¼ ì…€ë ‰íŠ¸í•˜ë©´, 	replyì •ë³´ë¥¼ í•„ìš”í•˜ë©´ ê°€ì ¸ì˜¬ê²Œ ì—¬ëŸ¬ ê±´ ìˆìœ¼ë‹ˆ, LAZYì „ëµ
	//	ì˜¤ë¡œì§€ Boardí…Œì´ë¸”ì— selectí•  ë•Œ, ì¡°ì¸í•´ì„œ ê°’ë§Œ ë„£ì–´ì£¼ê¸° ìœ„í•´ replyë¥¼ ë¶ˆëŸ¬ì˜¨ê²ƒ
//	@OneToMany(mappedBy = "board", fetch=FetchType.LAZY) // í•˜ë‚˜ì˜ Boardì™€ ì—¬ëŸ¬ê°œì˜ Reply
	//mappedBy = ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë‹¤.(FKê°€ ì•„ë‹ˆë‹¤.)DBì— ì¹¼ëŸ¼ì„ ë§Œë“¤ì§€ ë§ˆì„¸ìš”.
	//	@JoinColumn(name="replyId") ì¡°ì¸ì»¬ëŸ¼ì€ í•„ìš”ê°€ ì—†ë‹¤. í•œ ê°œì˜ ê²Œì‹œê¸€ idì— ì—¬ëŸ¬ê°œ Replyê°€ ë‹¬ë¦´ ê²½ìš°, ì œ1 ì •ê·œí™”ê°€ ê¹¨ì§„ë‹¤. í•„ìš”ì—†ìŒ
	//JPAì— ì˜í•´ ì¿¼ë¦¬ë¬¸ì„ DBì— ë‚ ë¦¬ë©´ ìë™ìœ¼ë¡œ Boardê°€ ê°€ì§„ ì™¸ë˜í‚¤ë“¤ì„ Joiní•´ì¤€ë‹¤.
//	private List<Reply> reply; //replyëŠ” í•œ ê°œì˜ Boardì— ì—¬ëŸ¬ ê°œ ë‹¬ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ Listí˜•íƒœë¡œ ì§€ì •

	//ë§Œì•½ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ì„ í•˜ë‚˜ ë§Œë“¤ê³  ëˆ„ë¥´ë©´ ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¨ë‹¤ë©´, EAGERë°©ì‹ìœ¼ë¡œ ëŒ“ê¸€ë²„íŠ¼ í•˜ë‚˜ëŠ” ê¼­ ê°€ì ¸ì˜¨ë‹¤.
	@OneToMany(mappedBy="board",fetch=FetchType.EAGER, cascade = CascadeType.REMOVE) //ë³´ë“œë¥¼ ì§€ìš¸ ë•Œ ëŒ“ê¸€ì„ ë‹¤ ì§€ì›€
	@JsonIgnoreProperties({"board"}) //Replyì—ì„œ í˜¸ì¶œì„ ë˜ í•˜ê²Œ ë  ë•Œ boardëŠ” getterí˜¸ì¶œì´ ì•ˆ ëœë‹¤ => ë¬´í•œì°¸ì¡° ë°©ì§€
	@OrderBy("id desc")//ì•„ì´ë”” ê°’ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•´ì¤Œ
	private List<Reply>replys;
	
	@CreationTimestamp //ìë™ìœ¼ë¡œ ê°’ ìƒì„±
	private Timestamp createDate;
	
	
}


```
- ë‹¤ìŒê³¼ ê°™ì´ ìƒì„± í™•ì¸
![image](https://user-images.githubusercontent.com/86938974/168276449-94b9b379-ff43-473b-8fb7-ad23cf38a988.png)
![image](https://user-images.githubusercontent.com/86938974/168276495-a8786d50-3852-4d07-8349-d3fec3ea7012.png)



	* Reply í…Œì´ë¸” ìƒì„±
```
package com.cos.blog.model;

import java.sql.Timestamp;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.ManyToOne;

import org.hibernate.annotations.CreationTimestamp;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Builder
@AllArgsConstructor
@NoArgsConstructor
@Data
@Entity
public class Reply {
		
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY) // í”„ë¡œì íŠ¸ì—ì„œ ì—°ê²°ëœ DBì˜ ë„˜ë²„ë§ ì „ëµì„ ë”°ë¼ê°„ë‹¤.
	private int id; //ì‹œí€€ìŠ¤, auto_increment
	
	@Column(nullable = false, length = 200)
	private String content;
	
	@ManyToOne //ì—¬ëŸ¬ê°œì˜ ë‹µë³€ì€ í•˜ë‚˜ì˜ ë³´ë“œ(ê²Œì‹œê¸€)ê³¼ ì—°ê²°ëœë‹¤.
	@JoinColumn(name="boardId") //boardId ì»¬ëŸ¼ ìƒì„± í›„ Boardë¥¼ ì°¸ì¡°
	private Board board; //Boardë¥¼ ì°¸ì¡°
	
	@ManyToOne //ì—¬ëŸ¬ê°œì˜ ë‹µë³€ì€ í•˜ë‚˜ì˜ ìœ ì €ê°€ ì“¸ ìˆ˜ ìˆë‹¤.
	@JoinColumn(name="userId")
	private User user; //ë‹µë³€ì„ ëˆ„ê°€ ì ì—ˆëŠ”ì§€ë„ ì•Œì•„ì•¼í•´ì„œ Userë¥¼ ì°¸ì¡°
	
	@CreationTimestamp
	private Timestamp createDate;

//	@Override
//	public String toString() {
//		return "Reply [id=" + id + ", content=" + content + ", board=" + board + ", user=" + user + ", createDate="
//				+ createDate + "]";
//	}
//	
	

//	public void update(User user, Board board, String content) {
//		setUser(user);
//		setBoard(board);
//		setContent(content);
//	}
}

```
- ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ë¨
![image](https://user-images.githubusercontent.com/86938974/168276706-bc0e369e-4e0f-482f-8944-107bf330feb2.png)

![image](https://user-images.githubusercontent.com/86938974/168276678-e04a295e-6839-43cb-9279-84ada0fbdd59.png)

	* Enum ì§€ì •
- Roleì˜ ë²”ìœ„ë¥¼ ì§€ì •í•´ì¤€ë‹¤.
![image](https://user-images.githubusercontent.com/86938974/168279950-f948c488-c112-4521-8017-7b20f7800e9a.png)

```
package com.cos.blog.model;

public enum RoleType {
	USER, ADMIN
}

```


* Repository (DAO ìƒì„±)
	* UserRepository ìƒì„±
```
package com.cos.blog.repository;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

import com.cos.blog.model.User;

//í•´ë‹¹ JpaRepositoryëŠ” Userí…Œì´ë¸”ì´ ê´€ë¦¬í•˜ëŠ” Repositoryì´ë©°, Userí…Œì´ë¸”ì˜ PKëŠ” Integerì´ë‹¤.
//JSPë¡œ ë”°ì§€ë©´ DAOë¼ê³  ìƒê°í•˜ë©´ ë¨(JpaRepositoryë¥¼ ìƒì† ë°›ì•˜ìœ¼ë¯€ë¡œ)
//ìë™ìœ¼ë¡œ bean ë“±ë¡ì´ ëœë‹¤.
//@Repository ìƒëµ ê°€ëŠ¥
public interface UserRepository extends JpaRepository<User, Integer>{

}
```

	* Exception ì²˜ë¦¬í•˜ê¸°
![image](https://user-images.githubusercontent.com/86938974/168285418-c8f8f194-a2e3-4471-9bbf-e21b64746ed5.png)

```
package com.cos.blog.handler;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestController;

import com.cos.blog.dto.ResponseDto;

@ControllerAdvice //ëª¨ë“  ì˜ˆì™¸ê°€ ë°œìƒì‹œ ì—¬ê¸°ë¡œ ë“¤ì–´ì˜´
@RestController
public class GlobalExceptionHandler {

	@ExceptionHandler(value = IllegalArgumentException.class)
	public String handleArgumentException(IllegalArgumentException e) {
		return "<h1>"+e.getMessage()+"</h1>";
	}
}
```

* ë©”ì¸í™”ë©´ ë§Œë“¤ê¸°
	* ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‚¬ìš©
	* ë‹¤ìŒê³¼ ê°™ì´ index.jsp, UserController, BoardController ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168287712-adb43842-1c94-474e-b977-5541530b6ac9.png)

![image](https://user-images.githubusercontent.com/86938974/168287941-183fe05d-9f70-4d66-a37b-1b2b617b8c46.png)


![image](https://user-images.githubusercontent.com/86938974/168287873-6c3fc9df-2940-4ccb-a6f3-13302b950720.png)


	* index.jsp ì½”ë“œ
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="layout/header.jsp"%>


<!-- 
request ì •ë³´ê°€ ë„˜ì–´ì˜¬ë•Œ BoardControllerì˜
model.addAttributeì—ì„œ ì„¤ì •í•œ boardsê°€ ë„˜ì–´ì˜¨ë‹¤.
 itemsì—ì„œ boardsë¥¼ ë°›ì•„ í•œ ê±´ì”© boardë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥
  -->
<c:forEach var="board" items="${boards.content}">
	<div class="container">
		<div class="card m-2">
			<div class="card-body">
				<!-- $í‘œì‹œ í›„ board.titleì„ í˜¸ì¶œí•˜ë©´ boardì˜ getterê°€ í˜¸ì¶œë˜ì–´ titleì„ ê°€ì ¸ì˜¨ë‹¤ -->
				<h4 class="card-title">${board.title}</h4>
				<a href="/board/${board.id }" class="btn btn-primary">ìƒì„¸ë³´ê¸°</a>
			</div>
		</div>
	</div>
</c:forEach>
<div>
	<ul class="pagination justify-content-center">
		<c:choose>
			<c:when test="${boards.first}">
				<li class="page-item disabled"><a class="page-link" href="?page=${boards.number-1 }">Previous</a></li>
			</c:when>
			<c:otherwise>
				<li class="page-item "><a class="page-link" href="?page=${boards.number-1 }">Previous</a></li>
			</c:otherwise>
		</c:choose>

		<c:choose>
			<c:when test="${boards.last}">
				<li class="page-item disabled"><a class="page-link" href="?page=${boards.number+1 }">Next</a></li>
			</c:when>
			<c:otherwise>
				<li class="page-item"><a class="page-link" href="?page=${boards.number+1 }">Next</a></li>
			</c:otherwise>
		</c:choose>
	</ul>
</div>







<%@ include file="layout/footer.jsp"%>

```
	* index.jspëŠ” ìƒë‹¨ê³¼ í•˜ë‹¨ì— ë”°ë¡œ ë§Œë“¤ì–´ë†“ì€ footer.jspì™€ header.jspë¥¼ include í•´ì¤€ë‹¤.
	* ë‹¤ìŒì€ footerì™€ header.jsp
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<br />
<div class="jumbotron text-center" style="margin-bottom: 0">
	<p>Created by ì‹¬ëŒ€ì„±</p>
	<p>ğŸ“ 010-4799-5309</p>
	<p>ğŸ´ ì¸ì²œê´‘ì—­ì‹œ ì„œêµ¬ ê°€ì •ë™</p>
</div>
</body>
</html>
```

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>

<!-- ì¸ì¦ì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸ -->
<sec:authorize access="isAuthenticated()">
	<!-- principal = current user objectì—ê²Œ direct accessë¥¼ í—ˆìš© -->
	<sec:authentication property="principal" var="principal" />
</sec:authorize>

<!DOCTYPE html>
<html lang="en">
<head>
<title>ì‹¬ëŒ€ì„±ì˜ ìŠ¤í”„ë§ë¶€íŠ¸ ë¸”ë¡œê·¸</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>

</head>
<body>

	<nav class="navbar navbar-expand-md bg-dark navbar-dark">
		<a class="navbar-brand" href="/">í™ˆ</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="collapsibleNavbar">

			<c:choose>
				<c:when test="${empty principal }">
					<ul class="navbar-nav">
						<li class="nav-item"><a class="nav-link" href="/auth/loginForm">ë¡œê·¸ì¸</a></li>
						<li class="nav-item"><a class="nav-link" href="/auth/joinForm">íšŒì›ê°€ì…</a></li>
					</ul>
				</c:when>
				<c:otherwise>
					<ul class="navbar-nav">
						<!-- ì•„ë˜ëŠ” /authë¥¼ ë¶™ì´ì§€ ì•ŠëŠ”ë‹¤. => ê¸€ì“°ê¸°, íšŒì›ì •ë³´, ë¡œê·¸ì•„ì›ƒì€ ë¡œê·¸ì¸ ëœ(ì¸ì¦ëœ) ìƒíƒœì—¬ì•¼ ê°€ëŠ¥ -->
						<li class="nav-item"><a class="nav-link" href="/board/saveForm">ê¸€ì“°ê¸°</a></li>
						<li class="nav-item"><a class="nav-link" href="/auth/updateForm">íšŒì›ì •ë³´</a></li>
						<li class="nav-item"><a class="nav-link" href="/logout">ë¡œê·¸ì•„ì›ƒ</a></li>
					</ul>
				</c:otherwise>
			</c:choose>
		</div>
	</nav>
	<br />
```
	* Controller ì½”ë“œ
```
package com.cos.blog.controller;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import com.cos.blog.service.BoardService;

@Controller
public class BoardController {

	
		@Autowired
		private BoardService boardService;
		
	
		//ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸ì…˜ì„ ì–´ë–»ê²Œ ì°¾ëŠ”ì§€?
		//@AuthenticationPrincipal PrincipalDetail principal
		@GetMapping({"","/"}) // ì•„ë¬´ê²ƒë„ ì•ˆ ì ì—ˆì„ ë•Œì™€ ìŠ¬ë˜ì‹œë¥¼ ë¶™ì˜€ì„ ë•Œ ì´ë™
		//ìŠ¤í”„ë§ì—ì„œëŠ” ë©”ì¸í˜ì´ì§€ë¡œ ê°ˆ ë•Œ ëª¨ë¸ì´ í•„ìš”í•¨		
		public String index(Model model, @PageableDefault(size=3, sort="id", direction = Sort.Direction.DESC) Pageable pageable) { 
			//index í˜ì´ì§€ë¡œ boardsë¥¼ ë„˜ê¸´ë‹¤.
			model.addAttribute("boards", boardService.ê¸€ëª©ë¡(pageable));//modelì€ jspì˜ requestë¼ê³  ìƒê°í•˜ë©´ ë¨
			// /WEB-INF/views/index.jsp ë¡œ ìë™
			return "index"; //controllerëŠ” ë¦¬í„´ì‹œ viewResolverì‘ë™, í•´ë‹¹ indexí˜ì´ì§€ë¡œ modelì˜ ì •ë³´ë¥¼ ë“¤ê³  ì´ë™
			
		}
	}
```


* ë¡œê·¸ì¸, íšŒì›ê°€ì… í™”ë©´ ë§Œë“¤ê¸°
	* user í´ë”ì— joinForm, loginForm ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168290266-edcb5dc5-23a8-4dec-a9f7-559658686996.png)
- loginForm.jsp
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>

<div class="container">
	<form action = "/auth/loginProc" method = "post">
		<div class="form-group">
			<label for="username">Username:</label>
			<input type="text"  name="username" class="form-control" placeholder="Enter username" id="username">
		</div>

		<div class="form-group">
			<label for="password">Password:</label> 
			<input type="password"  name="password" class="form-control" placeholder="Enter password" id="password">
		</div>
		<button id="btn-login" class="btn btn-primary">ë¡œê·¸ì¸</button>
		<a href = "https://kauth.kakao.com/oauth/authorize?client_id=33b04fbab6e3c7a483d83d4b74338eb2&redirect_uri=http://localhost:8000/auth/kakao/callback&response_type=code"><img  height = "38px" src="/image/kakao_login_button.png"></a>
	</form>

</div>

<!-- 
<script src="/js/user.js"></script>
 -->
<%@ include file="../layout/footer.jsp"%>

```

- joinForm.jsp ( íšŒì›ê°€ì… ) 
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>
<script src="/blog/js/user.js"></script>
<div class="container">
	<form>
		<div class="form-group">
			<label for="username">Username:</label> <input type="text" class="form-control" placeholder="Enter username" id="username">
		</div>
		<div class="form-group">
			<label for="password">Password:</label> <input type="password" class="form-control" placeholder="Enter password" id="password">
		</div>
		<div class="form-group">
			<label for="email">Email:</label> <input type="email" class="form-control" placeholder="Enter email" id="email">
		</div>
	</form>
	<button id="btn-save" class="btn btn-primary">íšŒì›ê°€ì…ì™„ë£Œ</button>
</div>

<!-- /ë¼ê³  ì§€ì •í•˜ë©´ staticí´ë”ë¥¼ ë°”ë¡œ ì°¾ì•„ê° -->
<script src="/js/user.js"></script>
<%@ include file="../layout/footer.jsp"%>

```

	* íšŒì›ê°€ì…ì„ ìœ„í•œ ê¸°ì´ˆì„¸íŒ…
- form íƒœê·¸ì—ì„œ ì„¤ì •í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ì„œ ajax ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ë‹¬í•œë‹¤.
- ìŠ¤í”„ë§ì€ ê¸°ë³¸ì ìœ¼ë¡œ staticì„ ì°¾ì•„ê°€ë¯€ë¡œ ì´ í´ë”ì— ì •ì  íŒŒì¼ì„ ìœ„ì¹˜ì‹œí‚¤ë©´ ëœë‹¤.
- user.js ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168291522-ff85f210-8a64-48eb-bf01-5e892859e99d.png)
- user.js ì½”ë“œ
```
index = {
	init:function(){
		$("#btn-save").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.save();
		});
		$("#btn-update").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.update();
		});
	},
	
	save:function(){
		//alert("userì˜ saveí•¨ìˆ˜ í˜¸ì¶œë¨");
		let data = {
			username:$("#username").val(),
			password: $("#password").val(),
			email: $("#email").val()
		};
		
		//ajaxí˜¸ì¶œ ì‹œ defaultê°€ ë¹„ë™ê¸° í˜¸ì¶œ
		// ajaxí†µì‹ ì„ ì´ìš©í•´ì„œ 3ê°œì˜ ë°ì´í„°ë¥¼ jsonìœ¼ë¡œ ë³€ê²½í•˜ì—¬ insertìš”ì²­
		//ajaxê°€ í†µì‹ ì„ ì„±ê³µí•˜ê³  ì„œë²„ê°€ jsonì„ ë¦¬í„´í•´ì£¼ë©´ ìë™ìœ¼ë¡œ ìë°” ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜
		$.ajax({
			type: "POST",
			url: "/auth/joinProc",
			data:JSON.stringify(data), //http bodyë°ì´í„° 
			contentType:"application/json; charset=utf-8", //bodyë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€
			dataType:"json"  //ìš”ì²­ì„ ì„œë²„ë¡œí•´ì„œ ì‘ë‹µì´ ì™”ì„ ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ê²ƒì´ ë¬¸ìì—´(ìƒê¸´ê²Œ jsonì´ë¼ë©´) => javascriptì˜¤ë¸Œì íŠ¸ë¡œ ë³€ê²½í•´ì¤Œ
			//íšŒì›ê°€ì… ìˆ˜í–‰ ìš”ì²­ì´ ì„±ê³µì‹œ doneì‹¤í–‰, ì‹¤íŒ¨ì‹œ failë¬¸ ì‹¤í–‰
		}).done(function(resp){
			if(resp.status === 500){
				alert("íšŒì›ê°€ì…ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
			}else{
				alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
				location.href="/";
			}
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 
	}
}
index.init();
```
	* api.UserApiController ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168410791-e3d8723a-b0cb-4458-9c0e-5231bf834691.png)
```
package com.cos.blog.controller.api;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.cos.blog.config.auth.PrincipalDetail;
import com.cos.blog.dto.ResponseDto;
import com.cos.blog.model.User;
import com.cos.blog.service.UserService;

@RestController//ë°ì´í„°ë§Œ ë¦¬í„´
public class UserApiController {
	
//	@Autowired
//	private HttpSession session;
	
	@Autowired //ì„¸ì…˜ ê°ì²´ëŠ” ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆê°€ beanìœ¼ë¡œ ë“±ë¡ì„ í•´ì„œ ê°€ì§€ê³  ìˆìŒ
	private UserService userService;
	
	@Autowired
	private AuthenticationManager authenticationManager;
	
	//íšŒì›ê°€ì… ì´ë¯€ë¡œ /auth ë¶™ì—¬ì„œ ì¸ì¦ x
	//ì™œ /auth/loginProcë¥¼ ì•ˆ ë§Œë“œëŠ”ì§€ : SecurityConfigì—ì„œ ê°€ë¡œì±„ê¸° ë•Œë¬¸
	@PostMapping("/auth/joinProc")
	public ResponseDto<Integer> save(@RequestBody User user) { //username, password, email
		System.out.println("UserApiController: save í˜¸ì¶œë¨");
		userService.íšŒì›ê°€ì…(user);
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1); // ìë°”ì˜¤ë¸Œì íŠ¸ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ ë¦¬í„´
		
	}
}
```
	* dto.ResponseDto ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168410866-dff19a7f-8156-4d63-a44d-9379b1a78406.png)

```
package com.cos.blog.dto;

import org.springframework.http.HttpStatus;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ResponseDto<T> {
	int status;
	T data;
	
}

```
	* service.UserService ìƒì„±
- repositoryëŠ” CRUDë¥¼ ë“¤ê³  ìˆë‹¤ë©´,
- ì„œë¹„ìŠ¤ëŠ” ë‘ê°œ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì„œ ì„œë¹„ìŠ¤í•  ìˆ˜ ìˆë‹¤. (ex)ì†¡ê¸ˆ ì„œë¹„ìŠ¤ëŠ” ìˆ˜ì‹ ê³¼ ì†¡ì‹ ì¸¡ ë‘˜ ë‹¤ ì—…ë°ì´íŠ¸ì— ì„±ê³µí•˜ê³  ì»¤ë°‹ í•´ì¤˜ì•¼í•œë‹¤.) 
![image](https://user-images.githubusercontent.com/86938974/168411029-302a2953-fe1d-4fbb-b6c4-a0ee3df9797b.png)
```
package com.cos.blog.service;



import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.cos.blog.model.RoleType;
import com.cos.blog.model.User;
import com.cos.blog.repository.UserRepository;

//ìŠ¤í”„ë§ì´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ í†µí•´ì„œ Beanì— ë“±ë¡ì„ í•´ì¤Œ. IoCë¥¼ í•´ì¤€ë‹¤.
@Service
public class UserService {

	@Autowired
	private UserRepository userRepository;
	
	@Transactional
	public void íšŒì›ê°€ì…(User user) {
		String rawPassword = user.getPassword();//1234ì›ë¬¸
		String encPassword = encoder.encode(rawPassword);//í•´ì‰¬í™”
		user.setPassword(encPassword);
		user.setRole(RoleType.USER);
		userRepository.save(user);
	}
}
	
```

* ì „í†µì ì¸ ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ìˆœì„œ
	* í†°ìº£ ì‹œì‘ - ì„œë²„ ì‘ë™
	* web.xml
	* context.xml -> DB ì—°ê²° í…ŒìŠ¤íŠ¸ 
	
	* request ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ web.xmlì„ ì‹¤í–‰í•œë‹¤.
	* web.xmlì—ì„œ DB ì—°ê²° ì„¸ì…˜ì„ ìƒì„±í•˜ê³ (JDBCê°€ ì»¤ë„¥ì…˜ ë¨, CRUD ê°€ëŠ¥)
	* íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœë‹¤.
	* í•„í„°ë¥¼ ê±°ì³ ìš”ì²­ë¶„ê¸°ê°€ ê°€ëŠ¥í•œ Controllerë¡œ ê°„ë‹¤. ControllerëŠ” ìš”ì²­ì„ í™•ì¸í•˜ê³  ìš”ì²­ì— ë§ëŠ” Serviceë¥¼ í˜¸ì¶œí•œë‹¤.
	* Serviceì—ì„œëŠ” ìš”ì²­ì„ í™•ì¸í•˜ê³  í…Œì´ë¸” ë‘ ê°œë¥¼ SELECT í•œë‹¤. DBì—ì„  Aì™€ Bì˜ ê³„ì¢Œ í…Œì´ë¸”ì„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê°ì²´í™” ì‹œì¼œì„œ ë§Œë“¤ì–´ë†“ëŠ”ë‹¤.
	* Serviceì—ì„œ SELECTëœ ê°ì²´ë¥¼ repositoryë¥¼ ê±°ì³ ì‘ë‹µ ë°›ì•„ ê°–ê³ ìˆëŠ”ë‹¤. ê·¸ í›„ Serviceì—ì„œ ê°ì²´ ê°’ì„ ë³€ê²½í•œë‹¤. (ì‹¤ì œ DBì—ëŠ” ë°˜ì˜ ì•ˆ ë¨, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê°ì²´ ë³€ê²½)
	* Controllerë¡œ ì‘ë‹µ ë°›ì•„ì„œ (RestControllerëŠ” JSON, ControllerëŠ” HTML ë¦¬í„´) ë¦¬í„´í•´ì¤€ë‹¤.
	* Controllerì—ì„œ ì‘ë‹µ í•´ì£¼ê³  íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œì‹œì¼œì„œ ìë™ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ê°’ì´ ë³€ê²½ëœ ê²ƒì„ DBì—ì„œ ë³€ê²½ê°ì§€í•˜ì—¬ Flushí•´ ì§‘ì–´ë„£ëŠ”ë‹¤. ê·¸ë¦¬ê³  DBì—°ê²° ì„¸ì…˜ ì¢…ë£Œ 
![image](https://user-images.githubusercontent.com/86938974/168411525-de5aa808-5a24-4a16-b36e-2372aa933250.png)

* ê¸°ì¡´ ë°©ì‹ ë¬¸ì œì  ê°œì„ ( ex) ì•¼êµ¬ íŒ€ ì •ë³´ )
	* Aê°€ ìš”ì²­ ì‹œ ì˜ì†ì„±ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‹œì‘í•œë‹¤.
	* Controllerì—ì„œ Serviceë¡œ ìš”ì²­ì´ ë„˜ì–´ê°ˆ ë•Œ JDBC ì»¤ë„¥ì…˜, íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ëœë‹¤.
	* Serviceì—ì„œ Controllerë¡œ ê°ì²´ë¥¼ ë„˜ê²¨ì¤„ ë•Œ JDBC, íŠ¸ëœì­ì…˜, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•œë‹¤.
	* ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ê°€ ì¤„ì–´ë“¤ê³  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¡œ ë¹¨ë¦¬ ëë‚˜ DBì˜ ë¶€í•˜ê°€ ì¤„ì–´ë“ ë‹¤.
	* ë§Œì•½ ì´ëŒ€í˜¸ ì„ ìˆ˜ì˜ ì •ë³´ë¥¼ ìš”ì²­í•˜ë©´ Playerì™€ Teamì€ Many To Oneì´ê³ , Eager ì „ëµì— ì˜í•´ ì„ ìˆ˜ ì •ë³´ ë¿ë§Œ ì•„ë‹ˆë¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— Teamì˜ ì •ë³´ë„ ë¶ˆëŸ¬ì™€ì§„ë‹¤.
	* repositoryì—ëŠ” ì´ëŒ€í˜¸ì„ ìˆ˜ì˜ ì •ë³´ì— ëŒ€í•œ ê°ì²´ë§Œ ì €ì¥ë˜ê³ (Eagerì´ë¯€ë¡œ ë¡¯ë° íŒ€ ì •ë³´ë„ ì´ëŒ€í˜¸ ê°ì²´ì— ì €ì¥ë˜ì–´ìˆìŒ) Serviceì—ì„œ Controllerë¡œ ë„˜ì–´ê°€ëŠ” ì‹œì ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸, JDBC, íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œëœë‹¤.
	* ë¹„ ì˜ì†ì„± ìƒíƒœê°€ ë˜ì—ˆìœ¼ë¯€ë¡œ Controllerì—ì„œ ì´ëŒ€í˜¸ì„ ìˆ˜ ì •ë³´ë¥¼ ëŒë ¤ì£¼ê³  ëë‚œë‹¤.
	* LAZY ì „ëµì¼ ê²½ìš° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì— ë¡¯ë° íŒ€ ì •ë³´ë¥¼ ê°–ê³ ì˜¤ì§€ ì•Šì•„ Controller íŒ€ ì •ë³´ê°€ í•„ìš”ì‹œ í˜¸ì¶œì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸, JDBC, íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œ ë˜ì—ˆê¸° ë•Œë¬¸)
	* ê·¸ë˜ì„œ LAZYì¼ ë•ŒëŠ” ë¹„ì–´ìˆëŠ” ë¡¯ë° íŒ€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë“¤ê³ ì˜¨ë‹¤. ì´ ë•ŒëŠ” Controllerê°€ ëë‚  ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ì—¬ í•„ìš”ì‹œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•´ ë¡¯ë° íŒ€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ìš©í•´ JDBCì»¤ë„¥ì…˜ì„ ì‹œì‘í•˜ì—¬ ë¡¯ë° íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
 	* Controllerì—ì„œ SelectëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, ê·¸ ì •ë³´ë¥¼ ë³€ê²½í•´ë„ ë³€ê²½ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ ìˆ˜ì •í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤. íŠ¸ëœì­ì…˜ê³¼ JDBCê°€ ë¨¼ì € ì¢…ë£Œë˜ê¸° ë•Œë¬¸


![image](https://user-images.githubusercontent.com/86938974/168411924-1fddb413-7e36-486f-9a42-7ff83f695bf7.png)


* ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸
	* pom.xmlì— ë‹¤ìŒ ì½”ë“œ ì‚½ì…
	* ì‹œíë¦¬í‹° íƒœê·¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚½ì…
```
	<dependency>
		<groupId>org.springframework.security</groupId>
		<artifactId>spring-security-taglibs</artifactId>
	</dependency>
	
	<dependency>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-security</artifactId>
	</dependency>
```
![image](https://user-images.githubusercontent.com/86938974/168412235-023d50f2-0e49-4779-87d2-9be65319d6b8.png)
- Maven Dependencies ì—ì„œ ë‹¤ìš´ë¡œë“œ í™•ì¸
- ë‹¤ìŒ ì½”ë“œë¥¼ header.jsp ë§¨ ìœ„ì— ì‚½ì…

```
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>

	* ì‹œíë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ë©´ í™ˆí˜ì´ì§€ ì–´ëŠê³³ì— ì ‘ê·¼í•˜ë˜ì§€ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ê°€ë¡œì±ˆë‹¤.
	* ìë™ìœ¼ë¡œ ì„¸ì…˜ ìƒì„±
	* ê·¸ ê°’ì„ principalì— ì €ì¥
<!-- ì¸ì¦ì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸ -->
<sec:authorize access="isAuthenticated()">
	<!-- principal = current user objectì—ê²Œ direct accessë¥¼ í—ˆìš© -->
	<sec:authentication property="principal" var="principal" />
</sec:authorize>
```

	* ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸ í˜ì´ì§€ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- ì¸ì¦ì´ ì•ˆ ëœ ì‚¬ìš©ìë“¤ì´ ì¶œì…í•  ìˆ˜ ìˆëŠ” ê²½ë¡œë“¤ /auth/** í—ˆìš©
- ê·¸ëƒ¥ ì£¼ì†Œê°€ / ì´ë©´ index.jspí—ˆìš©
- staticì´í•˜ì— ìˆëŠ” /js/** , /css/**, /image/** í—ˆìš©
- í—ˆìš©í•˜ëŠ” ì´ìœ ëŠ” ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì…ì‹œì—ëŠ” ì¸ì¦ì„ í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸

- UserApiController ë‹¤ìŒê³¼ ê°™ì´ /authë¥¼ ì•ì— ë¶™ì—¬ì£¼ë©´ ëœë‹¤.
```
//íšŒì›ê°€ì… ì´ë¯€ë¡œ /auth ë¶™ì—¬ì„œ ì¸ì¦ x
	//ì™œ /auth/loginProcë¥¼ ì•ˆ ë§Œë“œëŠ”ì§€ : SecurityConfigì—ì„œ ê°€ë¡œì±„ê¸° ë•Œë¬¸
	@PostMapping("/auth/joinProc")
	public ResponseDto<Integer> save(@RequestBody User user) { //username, password, email
		System.out.println("UserApiController: save í˜¸ì¶œë¨");
		userService.íšŒì›ê°€ì…(user);
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1); // ìë°”ì˜¤ë¸Œì íŠ¸ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ ë¦¬í„´
		
	}

```

	* config.SecurityConfig ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168412614-944997df-6e18-40b2-8e8d-ca18dc94c4c9.png)
```
package com.cos.blog.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

import com.cos.blog.config.auth.PrincipalDetailService;

// ë¹ˆ ë“±ë¡ : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ê°ì²´ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒ(IoCê´€ë¦¬)
@Configuration
//ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ê°€ì„œ ì‹¤í–‰ì´ ë˜ê¸° ì „ ëª¨ë“  ìš”ì²­ì´ ì´ê³³ìœ¼ë¡œ ì˜¨ë‹¤.
@EnableWebSecurity //ì‹œíë¦¬í‹° í•„í„°ê°€ ë“±ë¡ì´ ëœë‹¤.  = ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ í™œì„±í™” ë˜ì–´ ìˆëŠ”ë° ì–´ë–¤ ì„¤ì •ì„ í•´ë‹¹ íŒŒì¼(ì•„ë˜ SecurityConfig)ì—ì„œ í•˜ê² ë‹¤.
@EnableGlobalMethodSecurity(prePostEnabled = true) // íŠ¹ì • ì£¼ì†Œë¡œ ì ‘ê·¼ì„ í•˜ë©´ ê¶Œí•œ ë° ì¸ì¦ì„ ë¯¸ë¦¬ ì²´í¬í•˜ê² ë‹¤ëŠ” ëœ».
//ìœ„ ì„¸ê°œëŠ” ì„¸íŠ¸ì´ë‹¤. í•¨ê»˜ ë‹¤ë‹˜
public class SecurityConfig extends WebSecurityConfigurerAdapter {

@Override
	protected void configure(HttpSecurity http) throws Exception{
		//requestê°€ ì•„ë˜ ì£¼ì†Œ(antMatchersì˜ ì£¼ì†Œ)ë¡œ ë“¤ì–´ì˜¤ë©´, ëˆ„êµ¬ë‚˜ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë‹¤. permitAll
		http
			//formíƒœê·¸ì˜ idê°’ì„ ê°€ì ¸ì™€ì„œ ajaxë¡œ ìš”ì²­ì„ í–ˆê¸° ë•Œë¬¸ì— csrfí† í°ì´ ì—†ì–´ì„œ ë§‰ì•„ë²„ë¦¬ê¸° ë•Œë¬¸
			.csrf().disable()//csrfí† í° ë¹„í™œì„±í™” (í…ŒìŠ¤íŠ¸ì‹œ ê±¸ì–´ë‘ëŠ”ê²Œ ì¢‹ìŒ)
			.authorizeRequests()
			.antMatchers("/", "/auth/**","/js/**", "/css/**", "/image/**","/dummy/**")
			.permitAll()// /auth/**ëŠ” í—ˆë½í•˜ê³ ,
			.anyRequest()  //ë‹¤ë¥¸ Requestì£¼ì†ŒëŠ” 
			.authenticated() // ì¸ì¦ì„ í•´ì•¼í•´
		.and()
			.formLogin()
			//ë§¤í•‘ëœ /auth/loginFormì€ ìë™ìœ¼ë¡œ ëœ¸, '/'ë§Œ ë¶™ì—¬ì„œ ì ‘ê·¼í•˜ë©´ ì œí•œë˜ì–´ ìˆê¸° ë•Œë¬¸ì—
			//authë¡œ ê°ˆ ë•Œ ë¹¼ê³ ëŠ” ì¸ì¦ì´ í•„ìš”í•˜ë‹¤. ìœ„ì—ì„œ ê±¸ì–´ì¤¬ê¸° ë•Œë¬¸
			// ìŠ¬ëŸ¬ì‹œ '/'ë¡œ ì˜¤ë©´ ë‹¹ì—°íˆ ì¸ì¦ì´ í•„ìš”í•˜ë¯€ë¡œ ì•„ë˜ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
			//ì¸ì¦ì´ ë˜ì§€ ì•ŠëŠ” ì–´ë–¤ ìš”ì²­ì€ loginFormìœ¼ë¡œ ì˜¨ë‹¤.
			.loginPage("/auth/loginForm")
			//ìœ„ì—ì„œ ë¡œê·¸ì¸ì„ ìˆ˜í–‰ í›„ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ 
			.loginProcessingUrl("/auth/loginProc") //ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ í•´ë‹¹ ì£¼ì†Œë¡œ ìš”ì²­ì˜¤ëŠ” ë¡œê·¸ì¸ì„ ê°€ë¡œì±„ì„œ ëŒ€ì‹  ë¡œê·¸ì¸ í•´ì¤€ë‹¤.
			.defaultSuccessUrl("/");//ìœ„ ìš”ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œ ë˜ë©´ ì´ë™í•¨
			
		
	}

	
}
```

	* ë¹„ë°€ë²ˆí˜¸ í•´ì‰¬ í›„ íšŒì›ê°€ì…
- ìœ„ ì½”ë“œì— ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€
```
@Bean //IoCê°€ ëœë‹¤.
	//ì‹œíë¦¬í‹°ê°€ ë“¤ê³ ìˆëŠ” í•¨ìˆ˜
	public BCryptPasswordEncoder encodePWD() {
		//ì•”í˜¸í™”í•´ì„œ encPasswordì— ë„£ì–´ì¤Œ
		//	String encPassword = new BCryptPasswordEncoder().encode(null)
		//IoC = ë¦¬í„´ë˜ëŠ” ì•„ë˜ ê°ì²´ë¥¼ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•œë‹¤.
		return new BCryptPasswordEncoder();
	}	
```
- UserService.javaì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```
	@Autowired
	private BCryptPasswordEncoder encoder;
	
	@Transactional
	public void íšŒì›ê°€ì…(User user) {
		String rawPassword = user.getPassword();//1234ì›ë¬¸
		String encPassword = encoder.encode(rawPassword);//í•´ì‰¬í™”
		user.setPassword(encPassword);
		user.setRole(RoleType.USER);
		userRepository.save(user);
	}
```
	* config.authì— ë‹¤ìŒ íŒŒì¼ë“¤ ìƒì„±
	
![image](https://user-images.githubusercontent.com/86938974/168413127-6948ccfb-61a9-4542-80b0-e76c49876537.png)
- PrincipalDetail.java
```
package com.cos.blog.config.auth;

import java.util.ArrayList;
import java.util.Collection;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import com.cos.blog.model.User;

import lombok.Getter;


// ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ë¡œê·¸ì¸ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ê³  ì™„ë£Œê°€ ë˜ë©´ userDetails íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼
// ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ê³ ìœ í•œ ì„¸ì…˜ì¥ì†Œì— ì €ì¥ì„ í•´ì¤€ë‹¤.
//@Data //Getter Setter ë‹¤ ë§Œë“¬
@Getter
public class PrincipalDetail implements UserDetails {
	private User user; //ì»´í¬ì§€ì…˜(ê°ì²´ë¥¼ í’ˆê³ ìˆìŒ)

	public PrincipalDetail(User user) {
		this.user = user;
	}
	
	//alt shift s ì˜¤ë²„ë¼ì´ë“œ
	@Override
	public String getPassword() {
		return user.getPassword();
	}

	@Override
	public String getUsername() {
		return user.getUsername();
	}

	//ê³„ì •ì´ ë§Œë£Œë˜ì§€ ì•Šì•˜ëŠ”ì§€ ë¦¬í„´í•œë‹¤.(true:ë§Œë£Œ ì•ˆë¨)
	@Override
	public boolean isAccountNonExpired() {
		return true;
	}

	//ê³„ì •ì´ ì ê²¨ìˆëŠ”ì§€ ë¦¬í„´(true:ì•ˆ ì ê¹€)
	@Override
	public boolean isAccountNonLocked() {
		// TODO Auto-generated method stub
		return true;
	}

	//ë¹„ë°€ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì§€ ì•Šì•˜ëŠ”ì§€ ë¦¬í„´(true:ë§Œë£Œ ì•ˆë¨)
	@Override
	public boolean isCredentialsNonExpired() {
		// TODO Auto-generated method stub
		return true;
	}

	//ê³„ì • í™œì„±í™”(ì‚¬ìš©ê°€ëŠ¥)ì¸ì§€ ë¦¬í„´(true: í™œì„±í™”)
	@Override
	public boolean isEnabled() {
		// TODO Auto-generated method stub
		return true;
	}
	
	//ê³„ì •ì˜ ê¶Œí•œ ë¦¬í„´
	@Override
	// GrantedAuthorityë¥¼ ìƒì†í•œ í´ë˜ìŠ¤ í˜•íƒœì˜ Collectionê°ì²´ë¥¼ ë¦¬í„´	
	public Collection<? extends GrantedAuthority> getAuthorities() {
		
		//ArrayListì˜ ë¶€ëª¨ëŠ” Collectionì´ë‹¤
		Collection<GrantedAuthority> collectors = new ArrayList<>();
//		collectors.add(new GrantedAuthority() {
//
//			@Override
//			public String getAuthority() {
//				// ìŠ¤í”„ë§ì—ì„œ ROLEì„ ë°›ì„ ë•Œ ê·œì¹™, ROLEì„ ê¼­ ë„£ì–´ì¤˜ì•¼í•¨.				
//				return "ROLE_"+user.getRole(); //ROLE_USER ë¦¬í„´í•´ì¤˜ì•¼ ì¸ì‹ ê°€ëŠ¥
//			}
//		});
		
		collectors.add(()->{return "ROLE_"+user.getRole();});
		
		return collectors;
	}
	
}

```

- config.SecurityConfig.javaì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```
//ì‹œíë¦¬í‹°ê°€ ëŒ€ì‹  ë¡œê·¸ì¸í•´ì£¼ëŠ”ë° passwordë¥¼ ê°€ë¡œì±„ê¸° í•˜ëŠ”ë°
	//í•´ë‹¹ passwordê°€ ì–´ë–¤ê±¸ë¡œ í•´ì‰¬ê°€ ë˜ì–´ íšŒì›ê°€ì…ì´ ë˜ì—ˆëŠ”ì§€ ì•Œì•„ì•¼
	//ê°™ì€ í•´ì‰¬ë¡œ ì•”í˜¸í™”í•´ì„œ DBì— ìˆëŠ” í•´ì‰¬ë‘ ë¹„êµ ê°€ëŠ¥
	@Override
	protected void configure(AuthenticationManagerBuilder auth) throws Exception {
		auth.userDetailsService(principalDetailService).passwordEncoder(encodePWD());
	}
```
- PrincipalDetailServcie.java ì½”ë“œ
```
package com.cos.blog.config.auth;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import com.cos.blog.model.User;
import com.cos.blog.repository.UserRepository;


@Service //Beanë“±ë¡
public class PrincipalDetailService implements UserDetailsService {

	@Autowired
	private UserRepository userRepository;
	
	//ìŠ¤í”„ë§ì´ ë¡œê·¸ì¸ ìš”ì²­ì„ ê°€ë¡œì±Œ ë•Œ, username, passwordë³€ìˆ˜ ë‘ê°œë¥¼ ê°€ë¡œì±„ëŠ”ë°
	//passwordë¶€ë¶„ ì²˜ë¦¬ëŠ” ì•Œì•„ì„œ í•¨.
	//usernameì´ DBì— ìˆëŠ”ì§€ë§Œ í™•ì¸í•´ì£¼ë©´ ë¨. ê·¸ê±¸ ì•„ë˜ í•¨ìˆ˜ì—ì„œ í•¨
	@Override
	public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
		User principal = userRepository.findByUsername(username)
				.orElseThrow(()->{
					return new UsernameNotFoundException("í•´ë‹¹ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. : "+username);
				});
		return new PrincipalDetail(principal); //ì‹œíë¦¬í‹°ì˜ ì„¸ì…˜ì— ìœ ì € ì •ë³´ê°€ ì €ì¥ì´ ë¨.
	}
	
}

```
	* UserRepository.java ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168413378-cfbe7826-e845-4350-a166-59b643a142d5.png)
```
package com.cos.blog.repository;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

import com.cos.blog.model.User;

//í•´ë‹¹ JpaRepositoryëŠ” Userí…Œì´ë¸”ì´ ê´€ë¦¬í•˜ëŠ” Repositoryì´ë©°, Userí…Œì´ë¸”ì˜ PKëŠ” Integerì´ë‹¤.
//JSPë¡œ ë”°ì§€ë©´ DAOë¼ê³  ìƒê°í•˜ë©´ ë¨(JpaRepositoryë¥¼ ìƒì† ë°›ì•˜ìœ¼ë¯€ë¡œ)
//ìë™ìœ¼ë¡œ bean ë“±ë¡ì´ ëœë‹¤.
//@Repository ìƒëµ ê°€ëŠ¥
public interface UserRepository extends JpaRepository<User, Integer>{
	//SELECT*FROm user WHERE username = 1?; 
	Optional<User> findByUsername(String username);
}	
```

	* ê¸€ì“°ê¸° (saveForm.jsp)
![image](https://user-images.githubusercontent.com/86938974/168475502-2385ee9b-3995-467e-8216-fdfd092419fd.png)

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>

<div class="container">
	<form>
		<div class="form-group">
			<input type="text" class="form-control" placeholder="Enter title" id="title">
		</div>

		<div class="form-group">
			<textarea class="form-control summernote" rows="5" id="content"></textarea>
		</div>
	</form>
	<button id="btn-save" class="btn btn-primary">ê¸€ì“°ê¸°ì™„ë£Œ</button>
</div>

<script>
	$('.summernote').summernote({
		tabsize : 2,
		height : 300
	});
</script>
<script src="/js/board.js"></script>
<%@ include file="../layout/footer.jsp"%>


```
	* board.jsì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```
index = {
	init:function(){
		$("#btn-save").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.save();
		});
		
	save:function(){
		//alert("userì˜ saveí•¨ìˆ˜ í˜¸ì¶œë¨");
		let data = {
			title:$("#title").val(),
			content: $("#content").val()
		};
		
		$.ajax({
			type: "POST",
			url: "/api/board",
			data:JSON.stringify(data),
			contentType:"application/json; charset=utf-8", //bodyë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€
			dataType:"json" 
		}).done(function(resp){
			alert("ê¸€ì“°ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			location.href="/";
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 
	}
}
```
	* BoardApiController ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168475751-e98a353a-90be-4608-bdb5-38abc558a0a8.png)
```
package com.cos.blog.controller.api;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.cos.blog.config.auth.PrincipalDetail;
import com.cos.blog.dto.ReplySaveRequestDto;
import com.cos.blog.dto.ResponseDto;
import com.cos.blog.model.Board;
import com.cos.blog.service.BoardService;

@RestController//ë°ì´í„°ë§Œ ë¦¬í„´
public class BoardApiController {
	
	@Autowired
	private BoardService boardService;

	@PostMapping("/api/board")
	public ResponseDto<Integer> save(@RequestBody Board board, @AuthenticationPrincipal PrincipalDetail principal) {
		boardService.ê¸€ì“°ê¸°(board, principal.getUser());
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1); 
		
	}
}
```

	* BoardRepository ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168475798-3566d425-006c-450d-a7d3-b6703112f8fb.png)
```
package com.cos.blog.repository;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

import com.cos.blog.model.Board;
import com.cos.blog.model.User;

public interface BoardRepository extends JpaRepository<Board, Integer>{
	//Jpaë ˆí¬ì§€í† ë¦¬ê°€ ë‹¤ ë“¤ê³ ìˆìŒ, findAll()ë“±ë“±

}

```
	* BoardService ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168475814-887dbca5-3000-4676-942a-c2b597399c08.png)
```
package com.cos.blog.service;



import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.cos.blog.dto.ReplySaveRequestDto;
import com.cos.blog.model.Board;
import com.cos.blog.model.User;
import com.cos.blog.repository.BoardRepository;
import com.cos.blog.repository.ReplyRepository;
import com.cos.blog.repository.UserRepository;


@Service
public class BoardService {

	@Autowired
	private BoardRepository boardRepository;
	
	@Transactional
	public void ê¸€ì“°ê¸°(Board board, User user) { // title, contentë°›ìŒ
		board.setCount(0);
		board.setUser(user);
		boardRepository.save(board);

	}
}
```
	* ê¸€ ëª©ë¡ ë³´ê¸°
	* BoardControllerì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```
@Autowired
private BoardService boardService;
	
/ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸ì…˜ì„ ì–´ë–»ê²Œ ì°¾ëŠ”ì§€?
//@AuthenticationPrincipal PrincipalDetail principal
@GetMapping({"","/"}) // ì•„ë¬´ê²ƒë„ ì•ˆ ì ì—ˆì„ ë•Œì™€ ìŠ¬ë˜ì‹œë¥¼ ë¶™ì˜€ì„ ë•Œ ì´ë™
//ìŠ¤í”„ë§ì—ì„œëŠ” ë©”ì¸í˜ì´ì§€ë¡œ ê°ˆ ë•Œ ëª¨ë¸ì´ í•„ìš”í•¨		
public String index(Model model, @PageableDefault(size=3, sort="id", direction = Sort.Direction.DESC) Pageable pageable) { 
	//index í˜ì´ì§€ë¡œ boardsë¥¼ ë„˜ê¸´ë‹¤.
	model.addAttribute("boards", boardService.ê¸€ëª©ë¡(pageable));//modelì€ jspì˜ requestë¼ê³  ìƒê°í•˜ë©´ ë¨
	// /WEB-INF/views/index.jsp ë¡œ ìë™
	return "index"; //controllerëŠ” ë¦¬í„´ì‹œ viewResolverì‘ë™, í•´ë‹¹ indexí˜ì´ì§€ë¡œ modelì˜ ì •ë³´ë¥¼ ë“¤ê³  ì´ë™
			
}
```
	* BoardServiceì— ì½”ë“œ ì¶”ê°€
```
@Transactional(readOnly = true)
	//í˜ì´ì§€ íƒ€ì…ì˜ ë³´ë“œë“¤ì„ ë¦¬í„´
	public Page<Board> ê¸€ëª©ë¡(Pageable pageable){
		return boardRepository.findAll(pageable);
	}
```

	* ê¸€ ìƒì„¸ë³´ê¸°
	* BoardController, BoardService ì— ê¸€ìƒì„¸ë³´ê¸° ì¶”ê°€
- BoardController
```
@GetMapping("/board/{id}")
		public String findById(@PathVariable int id, Model model) {
			model.addAttribute("board", boardService.ê¸€ìƒì„¸ë³´ê¸°(id));

			return "board/detail";
			
		}
```
- BoardService
```
@Transactional(readOnly = true)
	public Board ê¸€ìƒì„¸ë³´ê¸°(int id) {
		return boardRepository.findById(id)
				.orElseThrow(()->{
					return new IllegalArgumentException("ê¸€ ìƒì„¸ë³´ê¸° ì‹¤íŒ¨: ì•„ì´ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				});
	}
```

- detail.jsp ìƒì„±(ê¸€ ìƒì„¸ë³´ê¸° í˜ì´ì§€)
![image](https://user-images.githubusercontent.com/86938974/168476648-b26637d9-6c38-43f0-a060-c7f3525166ae.png)
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>

<div class="container">
	<button class="btn btn-secondary" onclick="history.back()">ëŒì•„ê°€ê¸°</button>

	<c:if test="${board.user.id == principal.user.id}">
		<a href="/board/${board.id}/updateForm" class="btn btn-warning">ìˆ˜ì •</a>
		<button id="btn-delete" class="btn btn-danger">ì‚­ì œ</button>
	</c:if>
	<br /> <br />
	<div>
		ê¸€ ë²ˆí˜¸ : <span id="id"><i>${board.id} </i></span> ì‘ì„±ì : <span><i>${board.user.username} </i></span>
	</div>
	<br />
	<div>
		<h3>${board.title}</h3>
	</div>
	<hr />
	<div>
		<div>${board.content}</div>
	</div>
	<hr />

	<div class="card">
		<form>
			<input type="hidden" id="userId" value="${principal.user.id}" /> <input type="hidden" id="boardId" value="${board.id}" />
			<div class="card-body">
				<textarea id="reply-content" class="form-control" rows="1"></textarea>
			</div>
			<div class="card-footer">
				<button type="button" id="btn-reply-save" class="btn btn-primary">ë“±ë¡</button>
			</div>
		</form>
	</div>
	<br />
	<div class="card">
		<div class="card-header">ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸</div>
		<ul id="reply-box" class="list-group">
			<c:forEach var="reply" items="${board.replys }">
				<li id="reply-${reply.id }" class="list-group-item d-flex justify-content-between">
					<div>${reply.content }</div>
					<div class="d-flex">
						<div class="font-italic">ì‘ì„±ì : ${reply.user.username} &nbsp;</div>
						<c:if test="${reply.user.id == principal.user.id}">
							<button onClick="index.replyDelete(${board.id}, ${reply.id})" class="badge">ì‚­ì œ</button>
						</c:if>
					</div>
				</li>
			</c:forEach>
		</ul>
	</div>
</div>

<script src="/js/board.js"></script>
<%@ include file="../layout/footer.jsp"%>

```

	* ê¸€ ì‚­ì œí•˜ê¸°
- board.jsì— ë‹¤ìŒ ì½”ë“œ ì¶”ê°€
```
$("#btn-delete").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.deleteById();
		});
deleteById:function(){
		let id = $("#id").text();
		$.ajax({
			type: "DELETE",
			url: "/api/board/"+id,
			dataType:"json",
			contentType:'application/json; charset=utf-8'
		}).done(function(resp){
			alert("ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			location.href="/";
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 
	}
```
- BoardApiController ì— ì¶”ê°€
```
@DeleteMapping("/api/board/{id}")
	public ResponseDto<Integer> deleteById(@PathVariable int id){
		boardService.ê¸€ì‚­ì œí•˜ê¸°(id);
		//1ì„ ë¦¬í„´í•˜ë©´ ì •ìƒì´ë¼ëŠ” ëœ»
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1); 
	}
```
- BoardServiceì— ì¶”ê°€
```
@Transactional
	public void ê¸€ì‚­ì œí•˜ê¸°(int id) {
		System.out.println("ê¸€ì‚­ì œí•˜ê¸°:"+id);
		boardRepository.deleteById(id);
	}
```

	* ê¸€ ìˆ˜ì •í•˜ê¸° (BoardControllerì— ì¶”ê°€)
```
@GetMapping("/board/{id}/updateForm")
		public String updateForm(@PathVariable int id, Model model) {
			model.addAttribute("board", boardService.ê¸€ìƒì„¸ë³´ê¸°(id));
			return "board/updateForm";
		}
```
- updateForm.jsp ìƒì„±
![image](https://user-images.githubusercontent.com/86938974/168609034-ec80b904-4580-4962-aa8f-9b42b82383f6.png)
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>
<script src="/blog/js/user.js"></script>
<div class="container">
	<form>
		<input type="hidden" id="id" value="${principal.user.id}" />
		<div class="form-group">
			<label for="username">Username:</label> <input type="text" value="${principal.user.username}" name="username" class="form-control" placeholder="Enter username" id="username">
		</div>

		<c:if test="${empty principal.user.oauth}">
			<div class="form-group">
				<label for="password">Password:</label> 
				<input type="password" name="password" class="form-control" placeholder="Enter password" id="password">
			</div>
		</c:if>
		<div class="form-group">
			<label for="email">Email:</label> 
			<input type="email" value="${principal.user.email}" class="form-control" placeholder="Enter email" id="email" readonly>
		</div>
	</form>
	<button id="btn-update" class="btn btn-primary">íšŒì›ìˆ˜ì •ì™„ë£Œ</button>
</div>

<!-- /ë¼ê³  ì§€ì •í•˜ë©´ staticí´ë”ë¥¼ ë°”ë¡œ ì°¾ì•„ê° -->
<script src="/js/user.js"></script>
<%@ include file="../layout/footer.jsp"%>


```
- board.jsì— ì¶”ê°€
```
$("#btn-update").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.update();
		});
		
update:function(){
		let id = $("#id").val();

		let data = {
			title:$("#title").val(),
			content: $("#content").val()
		};
		
		$.ajax({
			type: "PUT",
			url: "/api/board/"+id,
			data:JSON.stringify(data),
			contentType:"application/json; charset=utf-8", //bodyë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€
			dataType:"json" 
		}).done(function(resp){
			alert("ê¸€ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			location.href="/";
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 
	}
```
- BoardApiControllerì— ì¶”ê°€
```
@PutMapping("/api/board/{id}")
	public ResponseDto<Integer> update(@PathVariable int id, @RequestBody Board board){
		boardService.ê¸€ìˆ˜ì •í•˜ê¸°(id, board);
		return new ResponseDto<Integer>(HttpStatus.OK.value(),1);
		
	}
```

- BoardServiceì— ì¶”ê°€
```
@Transactional
	public void ê¸€ìˆ˜ì •í•˜ê¸°(int id, Board requestBoard) {
		Board board = boardRepository.findById(id)
				.orElseThrow(()->{
					return new IllegalArgumentException("ê¸€ ì°¾ê¸° ì‹¤íŒ¨: ì•„ì´ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				}); //ì˜ì†í™” ì™„ë£Œ
		board.setTitle(requestBoard.getTitle());
		board.setContent(requestBoard.getContent());
		//í•´ë‹¹ í•¨ìˆ˜ë¡œ ì¢…ë£Œì‹œ(Serviceê°€ ì¢…ë£Œë  ë•Œ)íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œëœë‹¤. ì´ë•Œ ë”í‹°ì²´í‚¹ - ìë™ ì—…ë°ì´íŠ¸ê°€ ë¨, db flush
	}
```
	* íšŒì› ìˆ˜ì •í•˜ê¸°
- UserControllerì— ì½”ë“œ ì¶”ê°€
```
@GetMapping("/auth/updateForm")
	public String updateForm(@AuthenticationPrincipal PrincipalDetail principal) {
		return "user/updateForm";
	}
```

- updateForm.jsp ìƒì„±
```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../layout/header.jsp"%>
<script src="/blog/js/user.js"></script>
<div class="container">
	<form>
		<input type="hidden" id="id" value="${principal.user.id}" />
		<div class="form-group">
			<label for="username">Username:</label> <input type="text" value="${principal.user.username}" name="username" class="form-control" placeholder="Enter username" id="username">
		</div>

		<c:if test="${empty principal.user.oauth}">
			<div class="form-group">
				<label for="password">Password:</label> 
				<input type="password" name="password" class="form-control" placeholder="Enter password" id="password">
			</div>
		</c:if>
		<div class="form-group">
			<label for="email">Email:</label> 
			<input type="email" value="${principal.user.email}" class="form-control" placeholder="Enter email" id="email" readonly>
		</div>
	</form>
	<button id="btn-update" class="btn btn-primary">íšŒì›ìˆ˜ì •ì™„ë£Œ</button>
</div>

<!-- /ë¼ê³  ì§€ì •í•˜ë©´ staticí´ë”ë¥¼ ë°”ë¡œ ì°¾ì•„ê° -->
<script src="/js/user.js"></script>
<%@ include file="../layout/footer.jsp"%>

```

- user.js ì— ì½”ë“œ ì¶”ê°€
```
$("#btn-update").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.update();
		});
update:function(){

		let data = {
			id : $("#id").val(),
			username:$("#username").val(),
			password:$("#password").val(),
			email: $("#email").val()
		};
		
		$.ajax({
			type: "PUT",
			url: "/user",
			data:JSON.stringify(data),
			contentType:"application/json; charset=utf-8", //bodyë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€
			dataType:"json" 
		}).done(function(resp){
			alert("íšŒì›ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			location.href="/";
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 
	}
```
- userApiController, SecurityConfigì— ì½”ë“œ ì¶”ê°€ (ì„¸ì…˜ ê°’ ë³€ê²½ ì½”ë“œ)

- SecurityConfig
```
@Bean
	@Override
	public AuthenticationManager authenticationManagerBean() throws Exception {
		return super.authenticationManagerBean();
	}
```
- userApiController
```
@PutMapping("/user")
	public ResponseDto<Integer> update(@RequestBody User user){ //RequestBodyê°€ ì—†ì„ ê²½ìš° Jsonì„ ëª»ë°›ìŒ, key=valueí˜•íƒœë¡œë§Œ ë°›ì„ ìˆ˜ ìˆê²Œë¨
		userService.íšŒì›ìˆ˜ì •(user);
		//íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ê¸° ë•Œë¬¸ì— DBì— ê°’ì€ ë³€ê²½ì´ ëìŒ.
		//í•˜ì§€ë§Œ ì„¸ì…˜ê°’ì€ ë³€ê²½ë˜ì§€ ì•Šì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ì§ì ‘ ì„¸ì…˜ê°’ì„ ë³€ê²½í•´ì¤˜ì•¼í•œë‹¤.
		//íšŒì›ìˆ˜ì •ì„ í•´ë„ DBì—ëŠ” ë³€ê²½ì´ ë˜ì§€ë§Œ íšŒì›ìˆ˜ì • íƒ­ì—ì„œ ë³¼ ë• ê·¸ëŒ€ë¡œì´ë‹¤.
		
		//ì„¸ì…˜ ë“±ë¡
		//ì–´ì¬í‹°ì¼€ì´ì…˜ ë§¤ë‹ˆì €ì—ê²Œ ìœ ì €ë„¤ì„ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë˜ì ¸ì„œ
		//ë§¤ë‹ˆì €ê°€ ìë™ìœ¼ë¡œ ì„¸ì…˜ë“±ë¡ í•´ì¤€ë‹¤. ì›Œë“œë¬¸ì„œ ì°¸ê³ 
		Authentication authentication = authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(user.getUsername(),user.getPassword()));
		SecurityContextHolder.getContext().setAuthentication(authentication);

		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1);
	}
```
- UserServiceì— ì½”ë“œ ì¶”ê°€
```
@Transactional
	public void íšŒì›ìˆ˜ì •(User user) {
		//ìˆ˜ì •ì‹œì—ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ User ì˜¤ë¸Œì íŠ¸ë¥¼ ì˜ì†í™”ì‹œí‚¤ê³ , ì˜ì†í™”ëœ User ì˜¤ë¸Œì íŠ¸ë¥¼ ìˆ˜ì •
		//selectë¥¼ í•´ì„œ Userì˜¤ë¸Œì íŠ¸ë¥¼ Dbë¡œ ë¶€í„° ê°€ì ¸ì˜¤ëŠ” ì´ìœ ëŠ” ì˜ì†í™”ë¥¼ í•˜ê¸° ìœ„í•´ì„œ
		// ì˜ì†í™”ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ë³€ê²½í•˜ë©´ DBì— Updateë¬¸ì„ ë‚ ë ¤ì£¼ê¸°ë•Œë¬¸	
		User persistance = userRepository.findById(user.getId()).orElseThrow(()->{
			return new IllegalArgumentException("íšŒì› ì°¾ê¸° ì‹¤íŒ¨");
		});
		
		// oauthì— ê°’ì´ ì—†ìœ¼ë©´ ìˆ˜ì • ê°€ëŠ¥
		// Validate ì²´í¬, ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í•œ ì‚¬ëŒë“¤ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½ ëª» í•˜ê²Œë” í•´ì•¼í•¨
		if(persistance.getOauth()==null || persistance.getOauth().equals("")) {
			String rawPassword = user.getPassword();
			String encPassword = encoder.encode(rawPassword);
			persistance.setPassword(encPassword);
			persistance.setEmail(user.getEmail());
		}
		
		//íšŒì›ìˆ˜ì • í•¨ìˆ˜ ì¢…ë£Œì‹œ = ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ = íŠ¸ëœì­ì…˜ ì¢…ë£Œ = commitì´ ìë™ìœ¼ë¡œ ë¨
		//ì˜ì†í™”ëœ persistanceê°ì²´ì˜ ë³€í™”ê°€ ê°ì§€ë˜ë©´ ë”í‹°ì²´í‚¹ì´ ë˜ì–´ updateë¬¸ì„ ë‚ ë ¤ì¤€ë‹¤.

		}
```

	* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™˜ê²½ì„¤ì •
- https://developers.kakao.com/ ì ‘ì†
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€
![image](https://user-images.githubusercontent.com/86938974/168613728-44718a7a-0cf2-4aa1-86c5-3de1d1dd861b.png)
- REST API í‚¤ ì €ì¥
![image](https://user-images.githubusercontent.com/86938974/168613790-6c126781-1dfe-4939-a44a-d226c22b9318.png)
- ì›¹ í”Œë«í¼ ë“±ë¡
![image](https://user-images.githubusercontent.com/86938974/168613905-b1527ba8-9bdd-452e-bdfe-596803165eeb.png)
- Redirect URI (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ ì •ìƒ ì‹¤í–‰ì‹œ ì‘ë‹µë°›ì„ ì£¼ì†Œ)
![image](https://user-images.githubusercontent.com/86938974/168614046-89bf1c11-55ad-432a-bd47-1d346cfc822f.png)

- í”„ë¡œí•„ ì •ë³´ í•„ìˆ˜ ë™ì˜ (ì´ë©”ì¼ì€ ì„ íƒ ë™ì˜)
![image](https://user-images.githubusercontent.com/86938974/168614307-e7958ee0-91f0-4e74-9e4f-eccc33d6db87.png)

	* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ OAuth2.0 ì´ë€?
- ëª¨ë“  ì‚¬ì´íŠ¸ì— ë‚´ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆìŒ.
- ì´ ëª¨ë“  ì •ë³´ë“¤ì„ í•˜ë‚˜ì˜ ëŒ€í˜• í¬í„¸ì‚¬ì´íŠ¸ì—ì„œ ê´€ë¦¬í•˜ë©´ í¸í•¨.
- ex) naver, ì¹´ì¹´ì˜¤
- Open Auth : ì¸ì¦ ì²˜ë¦¬ë¥¼ ëŒ€ì‹  í•´ì¤€ë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ í™ê¸¸ë™ì´ Blogì— ë¡œê·¸ì¸ ìš”ì²­ì‹œ BlogëŠ” ì¹´ì¹´ì˜¤ì— ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ìš”ì²­ì„ í•œë‹¤.
- ë¸”ë¡œê·¸ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ í™ê¸¸ë™ì—ê²Œ ì œê³µí•˜ê³ , ì¹´ì¹´ì˜¤ ë²„íŠ¼ì„ í´ë¦­ì‹œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ìš”ì²­ì´ ì‹œì‘ëœë‹¤.
- ì¹´ì¹´ì˜¤ ì„œë²„ ìª½ìœ¼ë¡œ ìš”ì²­ëœ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì¸í•´ ì¹´ì¹´ì˜¤ ì„œë²„ì—ì„œëŠ” í™ê¸¸ë™ì—ê²Œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì°½, ë™ì˜ì°½ì„ ì œê³µí•œë‹¤.
- ëª¨ë‘ ë™ì˜ í›„ ë²„íŠ¼ í´ë¦­ì‹œ ì¹´ì¹´ì˜¤ ì„œë²„ì—ì„œ ë¸”ë¡œê·¸ ì„œë²„ìª½ìœ¼ë¡œ callbackì„ í•´ì¤€ë‹¤. ì´ ë•Œ codeë¥¼ ë§Œë“¤ì–´ì„œ ì¤€ë‹¤.
- Blog ì„œë²„ì—ì„  codeë¥¼ ë°›ì•˜ì„ ë•Œ, ì¸ì¦ì²˜ë¦¬ ì™„ë£Œë¥¼ í•œë‹¤. 
- ì¹´ì¹´ì˜¤ ì„œë²„ëŠ” ìì› ì„œë²„ë¥¼ ë“¤ê³  ìˆëŠ”ë° ì´ëŠ” í™ê¸¸ë™ì˜ ì •ë³´ë¥¼ ë“¤ê³  ìˆë‹¤. 
- Blog ì„œë²„ëŠ” ë°›ì€ codeê°’ì„ í†µí•´ ì¹´ì¹´ì˜¤ APIì„œë²„ì—ê²Œ ìì› ì„œë²„ì˜ ë°ì´í„° ê¶Œí•œ ìš”ì²­ì„ í•œë‹¤.
- ì¹´ì¹´ì˜¤ APIì„œë²„ì—ì„œ í™•ì¸ í›„ ì •ìƒì„ì„ í™•ì¸í•˜ë©´ Access Tokenì„ ì£¼ì–´ Blogì„œë²„ëŠ” ìì› ì„œë²„ ì•ˆì˜ í™ê¸¸ë™ ì •ë³´ì—ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬ ë°›ëŠ”ë‹¤.
- Access Tokenì„ í†µí•´ ì¹´ì¹´ì˜¤ ìì› ì„œë²„ ì•ˆì˜ ìœ ì € ì •ë³´ì— ëŒ€í•´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì–»ëŠ”ë‹¤.
- Access Tokenì€ ì‚¬ìš©ìê°€ Blogì„œë²„ì—ê²Œ ì¹´ì¹´ì˜¤ ìì› ì„œë²„ì— ì ‘ê·¼í•˜ì—¬ ìì‹ ì˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•œ ê²ƒì´ê³ ,
- codeëŠ” ë‹¨ì§€ ì¸ì¦ì— ì„±ê³µí•œ ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/86938974/168616500-86a466d5-4d03-4779-8a3a-b41a5efdd17d.png)

- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ - ë²„íŠ¼ ë‹¤ìš´ë¡œë“œ
![image](https://user-images.githubusercontent.com/86938974/168616991-26d3516b-4df5-4046-89e8-3e0706458b52.png)
- ë‹¤ìŒê³¼ ê°™ì´ ì €ì¥
![image](https://user-images.githubusercontent.com/86938974/168617121-a38b132b-de79-4de6-8009-837d6f203955.png)
- loginForm.jspì— aíƒœê·¸ ì¶”ê°€

```
<a href = "https://kauth.kakao.com/oauth/authorize?client_id=33b04fbab6e3c7a483d83d4b74338eb2&redirect_uri=http://localhost:8000/auth/kakao/callback&response_type=code"><img  height = "38px" src="/image/kakao_login_button.png"></a>
```
- ë¬¸ì„œ - REST API í‚¤ ë³µì‚¬
- (ë¡œê·¸ì¸ ìš”ì²­ ì£¼ì†Œ)
- {app_key}ì— í´ë¼ì´ì–¸íŠ¸ í‚¤ë¥¼, {redirect_uri}ì—ëŠ” ì½œë°± ì£¼ì†Œë¥¼ ë„£ëŠ”ë‹¤.
![image](https://user-images.githubusercontent.com/86938974/168617419-72f44a1e-bdaf-4425-a232-c10e9b64fb0d.png)
![image](https://user-images.githubusercontent.com/86938974/168617727-c6532a88-ff74-45fa-bc27-9ee889b445a4.png)

- í† í° ë°œê¸‰ ìš”ì²­
- ì£¼ì†Œ (POST) http bodyì— ë°ì´í„°ë¥¼ ì „ë‹¬(5ê°€ì§€ ë°ì´í„°)

![image](https://user-images.githubusercontent.com/86938974/168618601-ebd4383b-da13-4899-8117-81fcde64faf7.png)


![image](https://user-images.githubusercontent.com/86938974/168618232-2cdb998e-c78c-4863-bacb-306afa666326.png)




- UserControllerì— ì½”ë“œ ì¶”ê°€(5ê°€ì§€ ë°ì´í„° ì „ë‹¬)
```
@GetMapping("/auth/kakao/callback")
	public String kakaoCallback(String code) { // Dataë¥¼ ë¦¬í„´í•´ì£¼ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í•¨ìˆ˜
		
		//POSTë°©ì‹ìœ¼ë¡œ key=value ë°ì´í„°ë¥¼ ìš”ì²­(ì¹´ì¹´ì˜¤ìª½ìœ¼ë¡œ)
		RestTemplate rt = new RestTemplate();
		
		//HttpHeader ì˜¤ë¸Œì íŠ¸ ìƒì„±
		HttpHeaders headers = new HttpHeaders();
		headers.add("Content-type", "application/x-www-form-urlencoded;charset=utf-8");
		
		//HttpBody ì˜¤ë¸Œì íŠ¸ ìƒì„±
		MultiValueMap<String, String> params = new LinkedMultiValueMap<>();
		params.add("grant_type", "authorization_code");
		params.add("client_id", "33b04fbab6e3c7a483d83d4b74338eb2");
		params.add("redirect_uri", "http://localhost:8000/auth/kakao/callback");
		params.add("code", code);
		
		//HttpHeaderì™€ HttpBodyë¥¼ í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ì— ë‹´ê¸°
		HttpEntity<MultiValueMap<String, String>> kakaoTokenRequest = 
				new HttpEntity<>(params, headers);
		
		//Httpìš”ì²­í•˜ê¸° - Postë°©ì‹ìœ¼ë¡œ - ê·¸ë¦¬ê³  response ë³€ìˆ˜ì˜ ì‘ë‹µ ë°›ìŒ.
		ResponseEntity<String> response = rt.exchange( //exchange í•¨ìˆ˜ê°€ HttpEntityë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë°›ê¸°ë¡œ ë˜ì–´ìˆìŒ.
				"https://kauth.kakao.com/oauth/token",
				HttpMethod.POST,
				kakaoTokenRequest,
				String.class
		);
```

	* í† í°ì„ í†µí•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ(POST) ì‚¬ìš©ì ê´€ë¦¬ - REST API - ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì°¸ê³ 
![image](https://user-images.githubusercontent.com/86938974/168620477-070e6cea-6768-4852-81cc-f3b814ff5764.png)

- OAuthToken.javaìƒì„±
```
package com.cos.blog.model;

import lombok.Data;

@Data
public class OAuthToken {
	private String access_token;
	private String token_type;
	private String refresh_token;
	private int expires_in;
	private String scope;
	private int refresh_token_expires_in;
}

```

- KakaoProfile.java ìƒì„±
```

package com.cos.blog.model;

import lombok.Data;

@Data
//í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì—ëŠ” í¼ë¸”ë¦­ì´ í•˜ë‚˜ë°–ì— ì¡´ì¬í•˜ì§€ ëª»í•œë‹¤
public class KakaoProfile {

	public Long id;
	public String connected_at;
	public Properties properties;
	public KakaoAccount kakao_account;

	@Data
	public class Properties {

		public String nickname;
		public String profile_image;
		public String thumbnail_image;

	}

	
	@Data
	public class KakaoAccount {
		
		public Boolean profile_nickname_needs_agreement;
		public Boolean profile_image_needs_agreement;
		public Profile profile;
		public Boolean has_email;
		public Boolean email_needs_agreement;
		public Boolean is_email_valid;
		public Boolean is_email_verified;
		public String email;

		@Data
		public class Profile {
			
			public String profile_nickname_needs_agreement;
			public String nickname;
			public String thumbnail_image_url;
			public String profile_image_url;
			public Boolean is_default_image;

		}

	}

}

```

- UserControllerì— ì½”ë“œ ì¶”ê°€
```
//Gson, Json Simple, ObjectMapper
		ObjectMapper obMapper = new ObjectMapper();
		OAuthToken oauthToken = null;
		try {
			 	oauthToken = obMapper.readValue(response.getBody(), OAuthToken.class);
		}catch(JsonMappingException e) {
			e.printStackTrace();
		}catch(JsonProcessingException e) {
			e.printStackTrace();
		}
		
		System.out.println("ì¹´ì¹´ì˜¤ ì•¡ì„¸ìŠ¤ í† í°:"+oauthToken.getAccess_token());
		
		RestTemplate rt2 = new RestTemplate();
		
		//HttpHeader ì˜¤ë¸Œì íŠ¸ ìƒì„±
		HttpHeaders headers2 = new HttpHeaders();
		headers2.add("Authorization", "Bearer "+oauthToken.getAccess_token());
		headers2.add("Content-type", "application/x-www-form-urlencoded;charset=utf-8");
		
		//HttpHeaderì™€ HttpBodyë¥¼ í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ì— ë‹´ê¸°
		HttpEntity<MultiValueMap<String, String>> kakaoProfileRequest2 = 
				new HttpEntity<>(headers2);
		
		//Httpìš”ì²­í•˜ê¸° - Postë°©ì‹ìœ¼ë¡œ - ê·¸ë¦¬ê³  response ë³€ìˆ˜ì˜ ì‘ë‹µ ë°›ìŒ.
		ResponseEntity<String> response2 = rt2.exchange( //exchange í•¨ìˆ˜ê°€ HttpEntityë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë°›ê¸°ë¡œ ë˜ì–´ìˆìŒ.
				"https://kapi.kakao.com/v2/user/me",
				HttpMethod.POST,
				kakaoProfileRequest2,
				String.class
		);
		System.out.println(response2.getBody());
		
		ObjectMapper obMapper2 = new ObjectMapper();
		KakaoProfile kakaoProfile = null;
		try {
			kakaoProfile = obMapper2.readValue(response2.getBody(), KakaoProfile.class);
		}catch(JsonMappingException e) {
			e.printStackTrace();
		}catch(JsonProcessingException e) {
			e.printStackTrace();
		}
		
		//Userì˜¤ë¸Œì íŠ¸ : username, password, email
		System.out.println("ì¹´ì¹´ì˜¤ ì•„ì´ë””(ë²ˆí˜¸):"+kakaoProfile.getId());
		System.out.println("ì¹´ì¹´ì˜¤ ì´ë©”ì¼:"+kakaoProfile.getKakao_account().getEmail());
		
		System.out.println("ë¸”ë¡œê·¸ì„œë²„ ìœ ì €ë„¤ì„:"+kakaoProfile.getKakao_account().getEmail()+"_"+kakaoProfile.getId());
		System.out.println("ë¸”ë¡œê·¸ì„œë²„ ì´ë©”ì¼:"+kakaoProfile.getKakao_account().getEmail());
//		UUID garbagePassword = UUID.randomUUID();
		//UUIDë€ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ì–´ë–¤ íŠ¹ì • ê°’ì„ ë§Œë“¤ì–´ë‚´ëŠ” ì•Œê³ ë¦¬ì¦˜
		System.out.println("ë¸”ë¡œê·¸ì„œë²„ íŒ¨ìŠ¤ì›Œë“œ: "+cosKey);
		
		
		User kakaoUser = User.builder()
			.username(kakaoProfile.getKakao_account().getEmail()+"_"+kakaoProfile.getId())
			.password(cosKey)
			.email(kakaoProfile.getKakao_account().getEmail())
			.oauth("kakao")
			.build();
		
		//ê°€ì…ì í˜¹ì€ ë¹„ê°€ì…ì ì²´í¬ í•´ì„œ ì²˜ë¦¬
		User originUser = userService.íšŒì›ì°¾ê¸°(kakaoUser.getUsername());
		
		if(originUser.getUsername() == null) {
			System.out.println("ê¸°ì¡´ íšŒì›ì´ ì•„ë‹ˆê¸°ì— ìë™ íšŒì›ê°€ì…ì„ ì§„í–‰í•©ë‹ˆë‹¤.");
			userService.íšŒì›ê°€ì…(kakaoUser);
		}
		
		System.out.println("ìë™ ë¡œê·¸ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤.");
		//ë¡œê·¸ì¸ ì²˜ë¦¬
		Authentication authentication = authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(kakaoUser.getUsername(), cosKey));
		SecurityContextHolder.getContext().setAuthentication(authentication);
		return "redirect:/";
		
//		return "ì¹´ì¹´ì˜¤ í† í° ìš”ì²­ ì™„ë£Œ : í† í°ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µ:"+response.getBody();
	}
```

- UserServiceì— ì½”ë“œ ì¶”ê°€
- ì¹´ì¹´ì˜¤ ì‚¬ìš©ìë“¤ì€ íŒ¨ìŠ¤ì›Œë“œ ìˆ˜ì • ë¶ˆê°€ëŠ¥
```
@Transactional(readOnly = true)
	public User íšŒì›ì°¾ê¸°(String username) {
		User user = userRepository.findByUsername(username).orElseGet(()->{
			return new User();
		});
		return user;
}

@Transactional
	public void íšŒì›ìˆ˜ì •(User user) {
		//ìˆ˜ì •ì‹œì—ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ User ì˜¤ë¸Œì íŠ¸ë¥¼ ì˜ì†í™”ì‹œí‚¤ê³ , ì˜ì†í™”ëœ User ì˜¤ë¸Œì íŠ¸ë¥¼ ìˆ˜ì •
		//selectë¥¼ í•´ì„œ Userì˜¤ë¸Œì íŠ¸ë¥¼ Dbë¡œ ë¶€í„° ê°€ì ¸ì˜¤ëŠ” ì´ìœ ëŠ” ì˜ì†í™”ë¥¼ í•˜ê¸° ìœ„í•´ì„œ
		// ì˜ì†í™”ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ë³€ê²½í•˜ë©´ DBì— Updateë¬¸ì„ ë‚ ë ¤ì£¼ê¸°ë•Œë¬¸	
		User persistance = userRepository.findById(user.getId()).orElseThrow(()->{
			return new IllegalArgumentException("íšŒì› ì°¾ê¸° ì‹¤íŒ¨");
		});
		
		// oauthì— ê°’ì´ ì—†ìœ¼ë©´ ìˆ˜ì • ê°€ëŠ¥
		// Validate ì²´í¬, ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í•œ ì‚¬ëŒë“¤ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½ ëª» í•˜ê²Œë” í•´ì•¼í•¨
		if(persistance.getOauth()==null || persistance.getOauth().equals("")) {
			String rawPassword = user.getPassword();
			String encPassword = encoder.encode(rawPassword);
			persistance.setPassword(encPassword);
			persistance.setEmail(user.getEmail());
		}
		
		//íšŒì›ìˆ˜ì • í•¨ìˆ˜ ì¢…ë£Œì‹œ = ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ = íŠ¸ëœì­ì…˜ ì¢…ë£Œ = commitì´ ìë™ìœ¼ë¡œ ë¨
		//ì˜ì†í™”ëœ persistanceê°ì²´ì˜ ë³€í™”ê°€ ê°ì§€ë˜ë©´ ë”í‹°ì²´í‚¹ì´ ë˜ì–´ updateë¬¸ì„ ë‚ ë ¤ì¤€ë‹¤.

		}
```
	* ëŒ“ê¸€ ë””ìì¸
- detail.jspì— ì½”ë“œì¶”ê°€
```
<div class="card">
		<form>
			<input type="hidden" id="userId" value="${principal.user.id}" /> <input type="hidden" id="boardId" value="${board.id}" />
			<div class="card-body">
				<textarea id="reply-content" class="form-control" rows="1"></textarea>
			</div>
			<div class="card-footer">
				<button type="button" id="btn-reply-save" class="btn btn-primary">ë“±ë¡</button>
			</div>
		</form>
	</div>
	<br />
	<div class="card">
		<div class="card-header">ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸</div>
		<ul id="reply-box" class="list-group">
			<c:forEach var="reply" items="${board.replys }">
				<li id="reply-${reply.id }" class="list-group-item d-flex justify-content-between">
					<div>${reply.content }</div>
					<div class="d-flex">
						<div class="font-italic">ì‘ì„±ì : ${reply.user.username} &nbsp;</div>
						<c:if test="${reply.user.id == principal.user.id}">
							<button onClick="index.replyDelete(${board.id}, ${reply.id})" class="badge">ì‚­ì œ</button>
						</c:if>
					</div>
				</li>
			</c:forEach>
		</ul>
	</div>
```
	* ReplyRepository ìƒì„±
```
package com.cos.blog.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;

import com.cos.blog.model.Reply;

public interface ReplyRepository extends JpaRepository<Reply, Integer> {
	
//	ì¸í„°í˜ì´ìŠ¤ ì•ˆì—ì„œëŠ” í¼ë¸”ë¦­ ì—†ì–´ë„ ë¨
	//ìƒì„±ì í˜¸ì¶œì‹œ queryìˆ˜í–‰ë¨
	@Modifying
	@Query(value="INSERT INTO reply(userId, boardId, content, createDate) VALUES(?1, ?2, ?3, now())", nativeQuery = true)
	int mSave(int userId, int boardId, String content); //ì—…ë°ì´íŠ¸ëœ í–‰ì˜ ê°œìˆ˜ë¥¼ ë¦¬í„´í•´ì¤Œ.
}

```
- Boardë¥¼ Selectí•˜ë©´ EAGER ì „ëµì— ì˜í•´ replysê°€ ìë™ìœ¼ë¡œ ê°€ì ¸ì™€ì§„ë‹¤. ì—¬ê¸°ì„œ ReplyëŠ” Boardë¥¼ ë“¤ê³  ìˆëŠ”ë°, ë¬´í•œ ì°¸ì¡°ê°€ ì¼ì–´ë‚œë‹¤. ê·¸ë˜ì„œ Board ì•ˆì—ì„œ @JsonIgnorePropertiesë¥¼ ê±¸ì–´ì¤€ë‹¤.
```
	//ë§Œì•½ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ì„ í•˜ë‚˜ ë§Œë“¤ê³  ëˆ„ë¥´ë©´ ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¨ë‹¤ë©´, EAGERë°©ì‹ìœ¼ë¡œ ëŒ“ê¸€ë²„íŠ¼ í•˜ë‚˜ëŠ” ê¼­ ê°€ì ¸ì˜¨ë‹¤.
	@OneToMany(mappedBy="board",fetch=FetchType.EAGER, cascade = CascadeType.REMOVE) //ë³´ë“œë¥¼ ì§€ìš¸ ë•Œ ëŒ“ê¸€ì„ ë‹¤ ì§€ì›€
	@JsonIgnoreProperties({"board"}) //Replyì—ì„œ í˜¸ì¶œì„ ë˜ í•˜ê²Œ ë  ë•Œ boardëŠ” getterí˜¸ì¶œì´ ì•ˆ ëœë‹¤ => ë¬´í•œì°¸ì¡° ë°©ì§€
	@OrderBy("id desc")//ì•„ì´ë”” ê°’ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•´ì¤Œ
	private List<Reply>replys;
```

	* ëŒ“ê¸€ ì‘ì„±í•˜ê¸°
- board.js
```
$("#btn-reply-save").on("click",()=>{ //function(){} , ()=>{} thisë¥¼ ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ì„œ
			this.replySave();
		});
replySave:function(){
		let data = {
			userId: $("#userId").val(),
			boardId: $("#boardId").val(),
			content: $("#reply-content").val()
		};
		//console.log("boardId :  "+ data.boardId, "data.content:"+ data.content);
		//let boardId= $("#boardId").val();
		//let userId = $("#userId").val();
		
		$.ajax({
			type: "POST",
			url: '/api/board/'+data.boardId+'/reply',
			data:JSON.stringify(data),
			contentType:"application/json; charset=utf-8", //bodyë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€
			dataType:"json" 
		}).done(function(resp){
			alert("ëŒ“ê¸€ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
			location.href = '/board/'+data.boardId;
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 

	}
```

- BoardApiController ì¶”ê°€
```
@PostMapping("/api/board/{boardId}/reply")
	public ResponseDto<Integer> replySave(@RequestBody ReplySaveRequestDto replySaveRequestDto ) {
		
		// ë°ì´í„°ë¥¼ ë°›ì„ ë•Œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ dtoë¥¼ ë§Œë“¤ì–´ì„œ ë°›ëŠ”ê²Œ ì¢‹ë‹¤.
		boardService.ëŒ“ê¸€ì“°ê¸°(replySaveRequestDto);
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1); 
		
	}
```
- BoardService ì¶”ê°€
```
@Autowired
	private UserRepository userRepository;

@Transactional
	public void ëŒ“ê¸€ì“°ê¸°(ReplySaveRequestDto replySaveRequestDto  ) {
		replyRepository.mSave(replySaveRequestDto.getUserId(), replySaveRequestDto.getBoardId(), replySaveRequestDto.getContent());
		
	}
```
- ëŒ“ê¸€ ì‘ì„±ì‹œ DTO ì‚¬ìš© (ReplySaveRequestDto ìƒì„±)
![image](https://user-images.githubusercontent.com/86938974/168825218-0a5f25cf-36a4-455e-9215-6545d8633e7b.png)
```
package com.cos.blog.dto;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class ReplySaveRequestDto {
	private int userId;
	private int boardId;
	private String content;
}

```
	* ëŒ“ê¸€ ì‚­ì œí•˜ê¸°
- board.js
```
replyDelete:function(boardId, replyId){
	
		$.ajax({
			type: "DELETE",
			url: '/api/board/'+boardId+'/reply/'+replyId,
			dataType:"json" 
		}).done(function(resp){
			alert("ëŒ“ê¸€ì‚­ì œ ì„±ê³µ");
			location.href = '/board/'+boardId;
		}).fail(function(error){
			alert(JSON.stringify(error));
		}); 

	},
```
- BoardApiController ì¶”ê°€
```
@DeleteMapping("/api/board/{boardId}/reply/{replyId}")
	public ResponseDto<Integer> replyDelete(@PathVariable int replyId){
		boardService.ëŒ“ê¸€ì‚­ì œ(replyId);
		return new ResponseDto<Integer>(HttpStatus.OK.value(), 1);
	}
```
- BoardService
```
@Transactional
	public void ëŒ“ê¸€ì‚­ì œ(int replyId) {
		replyRepository.deleteById(replyId);
	}
```


* êµ¬í˜„
	* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
![image](https://user-images.githubusercontent.com/86938974/168829172-5fac36e2-0c04-4e73-88bc-edc3a73bb069.png)

![image](https://user-images.githubusercontent.com/86938974/168829381-e4b8f367-48a7-4816-8481-43ac22245641.png)

	* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ
![image](https://user-images.githubusercontent.com/86938974/168829518-19fb2dc0-e5dc-46db-95be-70ba0f4b9698.png)

	* íšŒì› ê°€ì…
![image](https://user-images.githubusercontent.com/86938974/168832430-a7c8e0f1-87c5-4d4e-9879-9216c02d72b8.png)
	* íšŒì›ì´ DBì— ë“¤ì–´ì˜´
![image](https://user-images.githubusercontent.com/86938974/168832614-58b51369-ce91-466c-b96d-cca55c9378ed.png)
	* íšŒì› ì •ë³´ ìˆ˜ì •
![image](https://user-images.githubusercontent.com/86938974/168832918-ce0c6c80-279e-43fd-b62b-5f7162b604ff.png)
	* ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ê°€ëŠ¥
![image](https://user-images.githubusercontent.com/86938974/168833307-dae00ea2-ae26-48a5-b780-44b6ec3f16a1.png)

	* ê¸€ ì“°ê¸°
![image](https://user-images.githubusercontent.com/86938974/168829902-2cf3e4fd-4345-432e-a78a-feb89050eb8c.png)
![image](https://user-images.githubusercontent.com/86938974/168829965-c3c5bd62-992f-4184-b753-ad9aa2332647.png)
![image](https://user-images.githubusercontent.com/86938974/168830049-f611fd03-de36-4ba8-817d-b0f4491b8c55.png)

	* ëŒ“ê¸€ ì“°ê¸°
![image](https://user-images.githubusercontent.com/86938974/168830117-92431189-570c-4ea5-8851-bf65add29b0c.png)
![image](https://user-images.githubusercontent.com/86938974/168830156-66ade122-f688-4f26-9cab-40b01cac7421.png)
	* ëŒ“ê¸€ ì‚­ì œ
![image](https://user-images.githubusercontent.com/86938974/168830275-a05c0397-3f52-4a03-9fc3-17ca89709151.png)
![image](https://user-images.githubusercontent.com/86938974/168830327-8ee70ab0-d643-4432-b635-f9237d934802.png)
	* ê¸€ ìˆ˜ì •
![image](https://user-images.githubusercontent.com/86938974/168830452-88cfe33e-42f4-4702-8c80-35b99c00179d.png)
![image](https://user-images.githubusercontent.com/86938974/168830524-db88eb60-63fa-475b-9564-ed97e7bf05c7.png)
![image](https://user-images.githubusercontent.com/86938974/168830599-b34a5000-c7fa-49d5-ab91-ee59c043e54b.png)
	* ê¸€ ì‚­ì œ
![image](https://user-images.githubusercontent.com/86938974/168830658-3048a752-6c31-4d92-9319-b686f7f6aa4d.png)
![image](https://user-images.githubusercontent.com/86938974/168830684-32c451b3-db76-4181-98b8-016bb1db48c2.png)
	* ë‹¤ë¥¸ íšŒì› ëŒ“ê¸€ ì‚­ì œ ë¶ˆê°€ëŠ¥(ë²„íŠ¼ ë‚˜ì˜¤ì§€ ì•ŠìŒ)
![image](https://user-images.githubusercontent.com/86938974/168830875-c3bef9b9-6fea-4687-bedf-7e091cc12851.png)
	* ë‹¤ë¥¸ íšŒì› ê¸€ ì‚­ì œ ë¶ˆê°€ëŠ¥, ìˆ˜ì • ë¶ˆê°€ëŠ¥
![image](https://user-images.githubusercontent.com/86938974/168830993-22d79642-1b51-4ef2-b22e-47945d39bed0.png)
	* MySQL ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
![image](https://user-images.githubusercontent.com/86938974/168831301-c2acba5c-19a5-4f35-9b46-317a720aadd7.png)
![image](https://user-images.githubusercontent.com/86938974/168831357-fde1f85b-9236-41a2-be0b-64fbfec316a2.png)
![image](https://user-images.githubusercontent.com/86938974/168831401-18215fd8-218f-4f3f-8bfe-6876a4b51e36.png)




